\graphicspath{{chapters/ch-quickref/figures/}}


\chapter{Quick Reference Guide}

\section{Virtual Sensors}

\subsection{VSD DTD \label{quickref_vsd_dtd}}

A graphical representation of the VSD Document Type Definition (DTD) is available on the \figref{figure:vsd_dtd}. The description of all these tags are given in the
\tableref{table:vsd_dtd}.

\image{vs-quick-ref-marked.pdf}{1.0}{90}{VSD DTD Quick Reference Card}{figure:vsd_dtd}

\begin{table*}[!htp]
	\centering
	{\normalfont\footnotesize
	\begin{tabulary}{\textwidth}{|C|J|}%
	\hline
		\multicolumn{2}{|c|}{\textbf{VSD DTD Quick Reference Card Description}} \\
	\hline
	\hline
		\textbf{Tag Number} &
		\textbf{Description} \\
	\hline
	\hline
		1 & \todo{TODO} \\ \hline
		2 & \todo{TODO} \\ \hline
		3 & \todo{TODO} \\ \hline
		4 & \todo{TODO} \\ \hline
		5 & \todo{TODO} \\ \hline
		6 & \todo{TODO} \\ \hline
		7 & \todo{TODO} \\ \hline
		8 & \todo{TODO} \\ \hline
		9 & \todo{TODO} \\ \hline
		10 & \todo{TODO} \\ \hline
		11 & \todo{TODO} \\ \hline
		12 & \todo{TODO} \\ \hline
		13 & \todo{TODO} \\ \hline
		14 & \todo{TODO} \\ \hline
		15 & \todo{TODO} \\ \hline
		16 & \todo{TODO} \\ \hline
		17 & \todo{TODO} \\ \hline
		18 & \todo{TODO} \\ \hline
		19 & \todo{TODO} \\ \hline
		20 & \todo{TODO} \\ \hline
		21 & \todo{TODO} \\ \hline
		22 & \todo{TODO} \\ \hline
		23 & \todo{TODO} \\ \hline
		24 & \todo{TODO} \\ \hline
		25 & \todo{TODO} \\ \hline
		26 & \todo{TODO} \\ \hline
		27 & \todo{TODO} \\ \hline
		28 & \todo{TODO} \\ \hline
		29 & \todo{TODO} \\ \hline
		30 & \todo{TODO} \\ \hline
		31 & \todo{TODO} \\ \hline
		32 & \todo{TODO} \\ \hline
		33 & \todo{TODO} \\ \hline
		34 & \todo{TODO} \\ \hline
		35 & \todo{TODO} \\ \hline
		36 & \todo{TODO} \\ \hline
		37 & \todo{TODO} \\ \hline
		38 & \todo{TODO} \\ \hline
		39 & \todo{TODO} \\ \hline
		40 & \todo{TODO} \\ \hline
		41 & \todo{TODO} \\ \hline
		42 & \todo{TODO} \\ \hline
		43 & \todo{TODO} \\ \hline
		44 & \todo{TODO} \\ \hline
		45 & \todo{TODO} \\ \hline
		46 & \todo{TODO} \\ \hline
		47 & \todo{TODO} \\ \hline
		48 & \todo{TODO} \\ \hline
		49 & \todo{TODO} \\ \hline
		50 & \todo{TODO} \\ \hline
		51 & \todo{TODO} \\ \hline
		52 & \todo{TODO} \\ \hline
	\end{tabulary}
	}
	\caption{VSD DTD Quick Reference Card Description}
	\label{table:vsd_dtd}
\end{table*}

\subsection{Email Notification Virtual Sensor \label{quickref_email_notification_vs}}

This virtual sensor implements an Email notification. The parameter for the virtual sensor are displayed on the \tableref{table:parameters_email_vs}

\begin{table*}[!htp]
	\centering
	{\normalfont\footnotesize
	\begin{tabulary}{\textwidth}{|C|C|C|C|J|}%
	\hline
		\multicolumn{5}{|c|}{\textbf{Parameters for Email VS}} \\
	\hline
	\hline
		\textbf{Parameter Name} &
		\textbf{Type} &
		\textbf{Mandatory} &
		\textbf{Default} &
		\textbf{Description} \\
	\hline
	\hline
		RECEIVER &
		String &	
		Yes &
		None &
		Name of the email recipient \\
	\hline
		receiver-email &
		String &	
		Yes &
		None &	
		Email address of the recipient \\
	\hline
		sender-email &
		String &	
		Yes &
		None &	
		Email address of the sender \\
	\hline
		mail-server &
		String &	
		Yes &
		None &	
		URL for the email (SMTP) server \\
	\hline
		subject &
		String &	
		Yes &
		None &	
		Subject of the email \\
	\hline
		message &
		String &	
		Yes &
		None &	
		Email message \\
	\hline
	\end{tabulary}
	}
	\caption{Parameters for Email VS}
	\label{table:parameters_email_vs}
\end{table*}

An example of how to use this virtual sensor is shown on the \listingref{listing:xml:emailnotification_vsd}.

\begin{xmlcode}[caption={Sample of Email Notification VSD file}, label=listing:xml:emailnotification_vsd]
<virtual-sensor name="email" priority="10">
	<processing-class>
		<class-name>gsn.vsensor.EmailVirtualSensor</class-name>
		<init-params>
			<param name="RECEIVER">John Connor</param>
			<param name="receiver-email">john.connor@gmail.com</param>
			<param name="sender-email">admin@sensorinternet.com</param>
			<param name="mail-server">smtp.gmail.com</param>
			<param name="subject">Abnormal Temperature Detected</param>
			<param name="MESSAGE">Sensor 114 has a value of 100 C.</param>   
		</init-params>
		<output-structure>
			<field name="temp" type="double" />
		</output-structure>
	</processing-class>
	<description>Send an Email Notification</description>
	<life-cycle pool-size="10" />
	<addressing />
	<storage history-size="10m" />
	<streams>
		<stream name="in1">
			<source alias="s1" sampling-rate="1" storage-size="1">
				<address wrapper="multiformat">
					<predicate key="HOST">localhost</predicate>
					<predicate key="PORT">22001</predicate>
				</address>
				<query>SELECT * FROM wrapper</query>
			</source>
			<query>SELECT temperature FROM s1 WHERE temperature >= 100</query>
		</stream>
	</streams>
</virtual-sensor>
\end{xmlcode}


\subsection{SMS Notification Virtual Sensor \label{quickref_sms_notification_vs}}

This virtual sensor implements SMS (Short Message Service) notification. This virtual sensor is very similar to the email virtual sensor â€“ an email is sent to a Mobile phone operator or SMS gateway provider based on the user's mobile account and the email is converted and send as a SMS to the given phone number. The parameter for the virtual sensor are described on the \tableref{table:parameters_sms_vs}.


\begin{table*}[!htp]
	\centering
	{\normalfont\footnotesize
	\begin{tabulary}{\textwidth}{|C|C|C|C|J|}%
	\hline
		\multicolumn{5}{|c|}{\textbf{Parameters for SMS VS}} \\
	\hline
	\hline
		\textbf{Parameter Name} &
		\textbf{Type} &
		\textbf{Mandatory} &
		\textbf{Default} &
		\textbf{Description} \\
	\hline
	\hline
		phone-number &
		String &	
		Yes &
		None &
		The mobile phone number to send the message \\
	\hline
		password &
		String &
		Yes &
		None &
		The password to login to the mobile operator or SMS gateway provider \\
	\hline
		sms-server &
		String &
		Yes &
		None &
		URL address of the mobile phone operator or SMS gatewat provider \\
	\hline
		message-format &
		String &
		Yes &
		None &
		The format of the SMS message in StringTemplate-syntax, e.g. Temperature: \$TEMP\$ where TEMP has some value given from the GSN StreamElement \\
	\hline
	\end{tabulary}
	}
	\caption{Parameters for SMS VS}
	\label{table:parameters_sms_vs}
\end{table*}

An example of how to use this virtual sensor is shown on the \listingref{listing:xml:smsnotification_vsd}.

\begin{xmlcode}[caption={Sample of SMS Notification VSD file}, label=listing:xml:smsnotification_vsd]
<virtual-sensor name="sms" priority="10">
	<processing-class>
		<class-name>gsn.vsensor.SMSVirtualSensor</class-name>
		<init-params>
			<param name="phone-number">004413243545</param>
			<param name="password">3524</param>
			<param name="sms-server">vodafone.co.uk</param>
			<param name="message-format">Temperature: $TEMP$</param>
		</init-params>
		<output-structure>
			<field name="temp" type="double" />
		</output-structure>
	</processing-class>
	<description>Send a SMS Notification</description>
	<life-cycle pool-size="10" />
	<addressing />
	<storage history-size="10m" />
	<streams>
		<stream name="in1">
			<source alias="s1" sampling-rate="1" storage-size="1">
				<address wrapper="multiformat">
					<predicate key="HOST">localhost</predicate>
					<predicate key="PORT">22001</predicate>
				</address>
				<query>SELECT * FROM wrapper</query>
			</source>
			<query>SELECT temperature FROM s1 WHERE temperature >= 100</query>
		</stream>
	</streams>
</virtual-sensor>
\end{xmlcode}

Note that this virtual sensor will only work if you have an account with a mobile phone operator or an internet SMS gateway provider. 

\section{Wrappers}

\subsection{Safe Storage Wrappers Default parameters}

The parameters shown on the \listingref{table:safe_storage_parameters} must be added to all the Wrappers that support the 
Safe Storage feature.

\begin{table*}[!htp]
	\centering
	{\normalfont\footnotesize
	\begin{tabulary}{\textwidth}{|C|C|C|C|J|}%
	\hline
		\multicolumn{5}{|c|}{\textbf{Safe Storage Parameters}} \\
	\hline
	\hline
		\textbf{Parameter Name} &
		\textbf{Type} &
		\textbf{Mandatory} &
		\textbf{Default} &
		\textbf{Description} \\
	\hline
	\hline
		ss-host &
		String &	
		Yes &
		None &
		The machine host name that runs the Safe Storage \\
	\hline
		ss-port &
		Integer &	
		Yes &
		None &
		The server port on which Safe Storage listen for connections \\
	\hline
		wrapper-name &
		String &	
		Yes &
		None &
		The Safe Storage side wrapper full classname (must extends \inlinecode{gsn.acquisition2.wrappers.AbstractWrapper2}) 
		or the short name from the \path{conf/safe\_storage\_wrappers.properties} file. \\
	\hline
		wrapper-keep-processed-ss-entries &
		Boolean &
		No &
		true &
		If this option is set to \inlinecode{true}, all the entries (processed or not) kept into the Safe Storage storage.
		If this option is set to \inlinecode{false}, the processed entries are removed from the Safe Storage storage once processed. \\
	\hline
		continue-on-error &
		Boolean &	
		No &
		true &
		Not yet implemented \\
	\hline
	\end{tabulary}
	}
	\caption{Safe Storage Parameters}
	\label{table:safe_storage_parameters}
\end{table*}

\subsection{GpsdWrapper: Integrating Generic NMEA GPS Devices with GSN}

GpsdWrapper is a GSN wrapper for communicating with gpsd and supports querying GPS devices compliant to

\begin{itemize}
 \item NMEA 0183 protocol
 \item Rockwell binary protocol
 \item TSIP binary protocol
 \item SiRF protocol
 \item Garmin binary protocol
 \item Evermore binary protocol
\end{itemize}


The \listingref{table:gpsd_parameters} lists the parameters for the Gpsd Wrapper. The \listingref{table:gpsd_output_structure} shows the output structure of this wrapper.

\begin{xmlcode}[caption={Sample of VSD using the Gpsd Wrapper}, label=listing:xml:gpsd_vsd]
<virtual-sensor name="gpsd" priority="10">
	<processing-class>
		<class-name>gsn.vsensor.BridgeVirtualSensor</class-name>
		<init-params/>
		<output-structure>
			<field name="Latitude" type="double"/>
			<field name="Longitude" type="double"/>
			<field name="Altitude" type="double"/>
			<field name="RateOfClimb" type="double"/>
			<field name="SpeedOverGround" type="double"/>
			<field name="GpsDeviceName" type="char(255)"/>
			<field name="GpsProtocol" type="char(255)"/>
			<field name="CountOfSatellites" type="int"/>
			<field name="VerticalDOP" type="double"/>
			<field name="HorizontalDOP" type="double"/>
			<field name="PositionalDOP" type="double"/>
			<field name="TimeDOP" type="double"/>
			<field name="GeometricDOP" type="double"/>
		</output-structure>
	</processing-class>
	<description>Send a SMS Notification</description>
	<life-cycle pool-size="10" />
	<addressing />
	<storage history-size="10m" />
	<streams>
		<stream name="input1">
			<source alias="source1" sampling-rate="1" storage-size="1">
				<address wrapper="gpsd">
					<predicate key="ListenerPort">2947</predicate>
					<predicate key="SamplingRate">2000</predicate>
					<predicate key="Timeout">22000</predicate>
				</address>
				<query>select * from wrapper</query>
			</source>
			<query>select * from source1</query>
		</stream> 
	</streams>
</virtual-sensor>
\end{xmlcode}
 

\begin{table*}[!htp]
	\centering
	{\normalfont\footnotesize
	\begin{tabulary}{\textwidth}{|C|C|C|C|J|}%
	\hline
		\multicolumn{5}{|c|}{\textbf{GpsdWrapper Parameters}} \\
	\hline
	\hline
		\textbf{Parameter Name} &
		\textbf{Type} &
		\textbf{Mandatory} &
		\textbf{Default} &
		\textbf{Description} \\
	\hline
	\hline
		HostName &
		String &	
		No &
		localhost &
		The hostname of GPS Daemon \\
	\hline
		ListenerPort &
		Integer &
		No &
		2947 &
		The listener port of GPS Daemon \\
	\hline
		Timeout &
		Long &
		No &
		20000 &
		The timeout for Telnet session to GPS Daemon in ms \\
	\hline 
		SamplingRate &
		Long &
		No &
		2000 &
		the rate of GPS sampling in ms \\
	\hline 
	\end{tabulary}
	}
	\caption{GpsdWrapper Parameters}
	\label{table:gpsd_parameters}
\end{table*}

\begin{table*}[!htp]
	\centering
	{\normalfont\footnotesize
	\begin{tabulary}{\textwidth}{|C|C|J|}%
	\hline
		\multicolumn{3}{|c|}{\textbf{GpsdWrapper Output Structure}} \\
	\hline
	\hline
		\textbf{Name} &
		\textbf{Type} &
		\textbf{Description} \\
	\hline
	\hline
		Latitude &
		\todo{type?} &
		Current latitude in degrees \\
	\hline 
		Longitude &
		\todo{type?} &
		Current longitude in degrees \\
	\hline 
		Altitude &
		\todo{type?} &
		Current altitude in meters above sea level \\
	\hline 
		RateOfClimb &
		\todo{type?} &
		Current rate of climb in meters per second \\
	\hline 
		SpeedOverGround &
		\todo{type?} &
		Current speed over ground in meters per second \\
	\hline 
		GpsDeviceName &
		\todo{type?} &
		Active GPS device name on the GPS host \\
	\hline 
		GpsProtocol &
		\todo{type?} &
		GPS protocol in use \\
	\hline 
		VerticalDOP &
		\todo{type?} &
		Vertical dilution of precision \\
	\hline 
		HorizontalDOP &
		\todo{type?} &
		Horizontal dilution of precision \\
	\hline 
		PositionalDOP &
		\todo{type?} &
		Positional dilution of precision \\
	\hline 
		TimeDOP &
		\todo{type?} &
		Time dilution of precision \\
	\hline 
		GeometricDOP &
		\todo{type?} &
		Geometric dilution of precision \\
	\hline 
	\end{tabulary}
	}
	\caption{GpsdWrapper Output Structure}
	\label{table:gpsd_output_structure}
\end{table*}

\subsubsection{Connecting a GPS device to gpsd}
\textbf{gpsd} is a Linux daemon that monitors one or more GPS devices attached to a host computer through serial or USB ports. All data of the GPS devices is made available to be queried on TCP port 2947 of the host computer. With gpsd, multiple GPS client applications (such as navigational and wardriving software) can share access to GPS devices without contention or loss of data. Also, gpsd responds to queries with a format that is substantially easier to parse than the NMEA 0183 emitted by most GPS devices.

\subsubsection{Using Bluetooth}
We are given a Bluetooth GPS device that we want to connect to a Linux host. In this tutorial, it's a HOLUX GPSlim 236.\\
\\
First, we need to start bluetooth services:
\begin{verbatim}
sudo /etc/init.d/bluetooth start
\end{verbatim}
Now, let's scan for bluetooth devices:
\begin{verbatim}
hcitool scan
\end{verbatim}
This should return a list of devices like
\begin{verbatim}
00:0B:0D:85:77:79 HOLUX GPSlim236
00:16:4E:D7:AE:5F Nokia N70
00:12:62:AF:C0:6E Nino
00:11:67:80:41:96 BT-GPS
\end{verbatim}
As already mentioned, we are going to use the HOLUX GPSlim 236. We want to map the HOLUX GPSlim 236 to a emulated RS-232 serial port. To this end, we use the Bluetooth protocol RFCOMM. That's pretty simple and goes as follows. First we create a config file for the RFCOMM:
\begin{verbatim}
sudo nano /etc/bluetooth/rfcomm.conf
\end{verbatim}
and add an entry for our HOLUX GPSlim 236 to this file
\begin{verbatim}
rfcomm0 {
	bind yes;
	device ''00:0B:0D:85:77:79'';
	channel 1;
	comment "Your comment here";
}
\end{verbatim}
This way, we are mapping the HOLUX to a emulated RS-232 serial port
\begin{verbatim}
/dev/rfcomm0
\end{verbatim}
by using the shell command
\begin{verbatim}
sudo rfcomm connect 0
\end{verbatim}
We should get the following return
\begin{verbatim}
Connected /dev/rfcomm0 to 00:0B:0D:85:77:79 on channel 1
Press CTRL-C for hangup
\end{verbatim}
Great, now we open a second terminal and connect the gpsd to our /dev/rfcomm0
\begin{verbatim}
sudo gpsd -b -N -D 4 /dev/rfcomm0
\end{verbatim}
You can telnet into the gpsd to play around and check if it's working correctly
\begin{verbatim}
telnet localhost 2947
\end{verbatim}
Cool, now we have a Bluetooth GPS device connected to a Linux host! A GSN server can use a GpsdWrapper to connect to this machine and read the GPS data.

\subsubsection{Using SSH reverse tunneling}
As you might already guess, the GpsdWrapper uses telnet to connect to gpsd. 

If you are concerned about security, or can not telnet into the GPS host machine, e.g. a mobile phone, or just want to be fancy, let's do some SSH reverse tunneling! By the way, this also would allow access to the GPS host if it were behind a firewall.

In this scenario, we connect a HOLUX GPSlim 236 via Bluetooth to a Nokia N810 which runs gpsd by default. Usually, the N810 doesn't have a static IP address and looking up the IP address and manually typing it in is annoying so we set up SSH reverse tunneling.\\
\\
\textbf{On the N810}, we simply execute 
\begin{verbatim}
ssh -N -R 1234:localhost:2947 user@gsn-server.com
\end{verbatim}
This forwards the port 1234 on gsn-server.com to the default gpsd port 2947 on the N810.\\
\\
\textbf{On the GSN host}, we can telnet into gpsd and play around by
\begin{verbatim}
telnet localhost 1234
\end{verbatim}

\section{GSN ANT Tasks \label{quickref_ant_task}}

{
\setlength{\tymin}{10pt}
\setlength{\tymax}{0.8\textwidth}
\begin{table*}[!htp]
	\centering
	{\normalfont\footnotesize
	\begin{tabulary}{\textwidth}{|C|J|}%
	\hline
		\multicolumn{2}{|c|}{\textbf{GSN ANT Tasks}} \\
	\hline
	\hline
		\textbf{Task Name} &
		\textbf{Description} \\
	\hline
	\hline
		start-all &
		Start both the Safe Storage and the GSN processes. \\
	\hline
		stop-all &
		Stop both the Safe Storage and the GSN processes. \\
	\hline
	\hline
		start-acquisition &
		Start the Safe Storage process. The wrapper that were loaded during the last runs will be automatically resumed and will directly start acquiring data. \\
	\hline
		clean-acquisition &
		Delete all the Safe Storage permanent storage and flush the list of Wrappers to resume. Use this task with caution since it may delete some unprocessed data forever. \\
	\hline
		stop-acquisition &
		Stop the Safe Storage process. \\
	\hline
	\hline
		gsn &
		Start the GSN process. You also have to start the Safe Storage process if you are using Safe Storage wrappers. \\
	\hline
		stop &
		Stop the GSN process. The Safe Storage processes if any will continue running and acquire the data. \\
	\hline
		restart &
		Stop and restart the GSN process. \\
	\hline
	\hline
		compile-reports &
		Compile the Jasper Reports located in the \path{gsn-reports} directory. Must be called after modification of any Jasper report 
		configuration file (.jrxml). \\
	\hline
	\hline
		\multicolumn{2}{|l|}{Use each of these tasks by typing in your terminal: \inlinecode{ant <Task Name>}} \\
	\hline
	\end{tabulary}
	}
	\caption{GSN ANT Tasks}
	\label{table:gsn_ant_tasks}
\end{table*}
}