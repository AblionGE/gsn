#LyX 1.5.1 created this file. For more info see http://www.lyx.org/
\lyxformat 276
\begin_document
\begin_header
\textclass book
\language english
\inputencoding auto
\font_roman default
\font_sans default
\font_typewriter default
\font_default_family default
\font_sc false
\font_osf false
\font_sf_scale 100
\font_tt_scale 100
\graphics default
\paperfontsize default
\spacing single
\papersize a4paper
\use_geometry false
\use_amsmath 1
\use_esint 0
\cite_engine basic
\use_bibtopic false
\paperorientation portrait
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\defskip medskip
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\author "" 
\author "" 
\end_header

\begin_body

\begin_layout Title
The Book of GSN
\end_layout

\begin_layout Standard
\begin_inset LatexCommand tableofcontents

\end_inset


\end_layout

\begin_layout Standard
\begin_inset FloatList table

\end_inset


\end_layout

\begin_layout Part
User's Guide
\end_layout

\begin_layout Chapter
Introduction
\end_layout

\begin_layout Section
Quick Start
\end_layout

\begin_layout Standard
GSN (for Global Sensor Networks
\begin_inset LatexCommand index
name "Global Sensor Networks"

\end_inset

) is a software project that started in 2005 at EPFL in the LSIR Lab by
 Ali Salehi, under the supervision of Prof.
 Karl Aberer.
 The initial goal was to provide a reusable software platform for the processing
 of data streams generated by wireless sensor networks.
 The project was successful, and was later reoriented towards a generic
 stream processing platform.
\end_layout

\begin_layout Standard
GSN acquires data, filters it with an intuitive, enriched SQL syntax, runs
 customisable algorithms on the results of the query, and outputs the generated
 data with its notification subsystem.
\end_layout

\begin_layout Standard
GSN can be configured to acquire data from various data sources.
 The high number of data sources in GSN allows for sophisticated data processing
 scenarios.
 In the unlikely event that your data sources are not supported, it is very
 easy to write a wrapper to make your hardware work with GSN (you can find
 more information about this in chapter 
\begin_inset LatexCommand ref
reference "cha:Writing-a-Wrapper"

\end_inset

).
\end_layout

\begin_layout Standard
GSN offers advanced data filtering functionnalities through an enhanced
 SQL syntax.
 It is assumed that the reader has some knowledge of the Standard Query
 Language (SQL).
 Using it for basic operations is fairly intuitive and you should be able
 to start using it from the examples provided in this document.
\end_layout

\begin_layout Section
Installing GSN (binary)
\end_layout

\begin_layout Standard
Due to the quick development cycle of GSN, you should install the latest
 version.
 It can always be found at 
\begin_inset LatexCommand htmlurl
target "http://gsn.sourceforge.net/download/"

\end_inset

.
\end_layout

\begin_layout Standard
Before installing GSN, please download the latest version (at least version
 6) of the Java Development Kit
\begin_inset LatexCommand index
name "Java Development Kit"

\end_inset

 from 
\begin_inset LatexCommand htmlurl
target "http://www.java.com"

\end_inset

.
 The default settings should be fine.
\end_layout

\begin_layout Standard
At the time of writing (14/2/2008), the version of the installer is 0.95
 is dated 15/04/2007.
 The installer includes a Windows batch file, gsn-win-nogui.bat and a unix
 shell script, gsn-unix-nogui.sh, which will run the GSN server (command
 line – no gui).
 You may need to modify the supplied configuration file conf/gsn.xml to select
 the database that you will be using.
 To use the in memory database ensure that the following line is uncommented:
 
\end_layout

\begin_layout Standard
<storage user="sa" password="" driver="org.hsqldb.jdbcDriver" url="jdbc:hsqldb:MEM
:." />
\end_layout

\begin_layout Standard
This version includes not tools to run the GSN Gui.
 
\end_layout

\begin_layout Section
Installing GSN (source)
\end_layout

\begin_layout Standard
You wish to run the most up to recent version of GSN (or run the Gui), then
 you will need to run the source code version which is available from the
 SVN repository at http://gsn.svn.sourceforge.net/viewvc/gsn/.
 
\end_layout

\begin_layout Subsection
To run from a command line
\end_layout

\begin_layout Itemize
Download the jakarta apache ant version 1.7.x or higher.
\end_layout

\begin_layout Itemize
add ANT_HOME/bin to your PATH.
\end_layout

\begin_layout Itemize
Ensure you have the latest version Sun JDK installed.
\end_layout

\begin_layout Itemize
Download and install TortoiseSVN (for windows) or SmartSvn (os independent)
 or a command line SVN client:
\end_layout

\begin_deeper
\begin_layout Standard

\family typewriter
svn co https://gsn.svn.sourceforge.net/svnroot/gsn/trunk gsn
\end_layout

\end_deeper
\begin_layout Itemize
Check out the GSN source code from link - https://gsn.svn.sourceforge.net/svnroot/g
sn
\end_layout

\begin_layout Itemize
Here are the list of the ant tasks:
\end_layout

\begin_layout Standard
\begin_inset Tabular
<lyxtabular version="3" rows="8" columns="2">
<features>
<column alignment="center" valignment="top" leftline="true" width="0">
<column alignment="left" valignment="top" leftline="true" rightline="true" width="0">
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Task Name
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Description
\end_layout

\end_inset
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
gsn
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Starts the GSN server.
\end_layout

\end_inset
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
restart
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Stops any running GSN server and starts it again.
\end_layout

\end_inset
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
stop
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Stops the currently runing GSN server.
\end_layout

\end_inset
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
gui
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Starts the GSN Gui
\end_layout

\end_inset
</cell>
</row>
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
jar
\end_layout

\end_inset
</cell>
<cell multicolumn="1" alignment="left" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Creates a jar file from the source.
\end_layout

\end_inset
</cell>
</row>
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
clean
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Removes the current build files and forces a rebuild.
 You may need to run this task once you get major updates from GSN svn.
\end_layout

\end_inset
</cell>
</row>
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
cleandb
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Removes the redundant tables which are create for holding GSN's internal
 states.
 You can run this task ONLY if there is no GSN is not running.
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
To run any of the aforementioned ant tasks simply write:
\family typewriter
 ant
\family default
 
\emph on
task_name
\end_layout

\begin_layout Subsection
Installing to Run and debug GSN in Eclipse
\end_layout

\begin_layout Standard
The GSN code can also be installed to run and debug in the Eclipse environment.
 
\end_layout

\begin_layout Itemize
Download and install Eclipse SDK 
\end_layout

\begin_layout Itemize
Download or import the GSN source code.
\end_layout

\begin_layout Itemize
Execute Eclipse 
\end_layout

\begin_layout Itemize
Go to File -> New -> Project 
\end_layout

\begin_layout Itemize
Choose “Java Project from Existing Ant Buildfile” -> Next 
\end_layout

\begin_layout Itemize
Browse -> go to folder gsn/trunk/ -> choose file build.xml 
\end_layout

\begin_layout Itemize
The project name will automatically appeard as gsn.
 In order to be able to use the debugging features of Eclipse with GSN,
 the following additional configuration is required
\backslash
footnote{As GSN uses the Jibx framework for reading the xml documents, it
 is not straightforward how to configure your eclipse environment to run/debug
 your virtual sensors.}: 
\end_layout

\begin_layout Itemize
Step 1: Setting the Ant Home for Eclipse:
\end_layout

\begin_deeper
\begin_layout Itemize
Go to Window Menu and select Preferences, on the left side, click on the
 ANT and then select Runtime.
\end_layout

\begin_layout Itemize
In the Classpath tab (opened on the center of the window) select Ant Home
 Entries, click on the Ant Home button and browse toward the directory that
 contains the files from the jakarta-ant archive.
 Click on OK.
\end_layout

\end_deeper
\begin_layout Itemize
Step 2: Setting an Ant Build System for your GSN project :
\end_layout

\begin_deeper
\begin_layout Itemize
On the Project menu and click on properties tab.
\end_layout

\begin_layout Itemize
Select Build on the left side and click on new and select Ant.
 
\end_layout

\begin_layout Itemize
A new window pops up which has several tabs : 
\end_layout

\begin_deeper
\begin_layout Itemize
Main Tab: 
\end_layout

\begin_deeper
\begin_layout Description
1.
 For build file, click on Browse Workspace and select the build.xml file
 
\end_layout

\begin_layout Description
2.
 For base directory, click on the Browse Workspace and click on the project
 name which contains the gsn source code.
 
\end_layout

\begin_layout Description
3.
 Let the Set an Input Handler selected.
 
\end_layout

\end_deeper
\begin_layout Itemize
Targets Tab:
\end_layout

\begin_deeper
\begin_layout Description
1.
 For After a Clean, click on Set Targets and select both Build and Bind.
 
\end_layout

\begin_layout Description
2.
 Click on Ok.
 
\end_layout

\end_deeper
\begin_layout Standard
You'll be returned back to the Builders page, make sure both Java Builder
 AND New Builder (or what ever you named it in the previous window) are
 selected.
 Click on OK.
\end_layout

\end_deeper
\end_deeper
\begin_layout Standard
Now you can debug your virtual sensors in eclipse, try it by setting a break
 point on a line in the main file.
 
\end_layout

\begin_layout Chapter
Configuring and running GSN
\end_layout

\begin_layout Section
The basics
\end_layout

\begin_layout Standard
GSN comes preconfigured with many virtual sensors activated.
\end_layout

\begin_layout Standard
It is possible to run GSN from a graphical user interface, or from the command
 line interface.
 The graphical interface is self explanatory ; you only need to run it and
 to click on the Start button.
 It also allows to easily analyze GSN log output.
\end_layout

\begin_layout Standard
The command to start GSN from the command line interface is:
\end_layout

\begin_layout LyX-Code
ant gsn
\end_layout

\begin_layout Standard
This will generate a very verbose output.
 Don't worry if the text goes too fast: all the information is stored in
 a log file (logs/gsn.log) that you can view with your favorite text editor.
 You can configure the log level by editing the file 
\family typewriter
conf/log4j.properties
\family default
.
 There are several log levels, from DEBUG (maximum logging) to WARN (minimum
 logging, maximum performance).
 If you want to reduce the log verbosity, change the log4j.rootLogger to
 INFO or WARN.
 The conf/log4j.properties file specifies two destinations for the output
 log, one of them is called 
\begin_inset Quotes eld
\end_inset

console
\begin_inset Quotes erd
\end_inset

 which presents the standard output and the other one called file which
 points to logs/gsn.log file.
 The log4j.rootLogger=WARN,console,file sets the logging level of both detination
s to WARN level.
 
\end_layout

\begin_layout Standard
If you want to debug your configuration, simply do the opposite.
 This parameter can also be set from the graphical user interface.
 
\end_layout

\begin_layout Standard
GSN does much more than generating log statements.
 You can access the web interface of your gsn server on 
\begin_inset LatexCommand url
target "http://127.0.0.1:22001"

\end_inset

.
\end_layout

\begin_layout Standard
You should see something like Figure 
\begin_inset LatexCommand ref
reference "fig:GSN-Web-Interface"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Standard
\begin_inset Caption

\begin_layout Standard
GSN Web Interface
\begin_inset LatexCommand label
name "fig:GSN-Web-Interface"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard

\hfill

\begin_inset Graphics
	filename figures/gsn-default-web-interface.png
	width 70page%
	keepAspectRatio

\end_inset


\hfill

\end_layout

\end_inset


\end_layout

\begin_layout Section
Some example configuration scenarios
\end_layout

\begin_layout Standard
As can be seen on Figure 
\begin_inset LatexCommand ref
reference "gsn-3-parts"

\end_inset

, GSN is built around three subsystems: data acquisition, data processing
 and data output.
 Most of the time these three functionalities can run on the same computer.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Standard
\begin_inset Caption

\begin_layout Standard
The three autonomous components of GSN
\begin_inset LatexCommand label
name "gsn-3-parts"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename figures/gsn-3parts-overview.png
	lyxscale 50
	width 100line%

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
However, more complex scenarios can be imagined, and GSN servers can collaborate
 so that each of them only deals with one of these three functions.
 This can be done to distribute the load, to deploy GSN on remote, resource-cons
trained devices or to interconnect many data sources into complex data processin
g scenarios.
\end_layout

\begin_layout Standard
For example, a user may deploy a network of wireless sensors in a building
 for intrusion detection.
 Data is collected through multiple, small computers connected to one of
 these sensors.
 Such data collection stations are often called 
\emph on
sinks
\emph default
.
 Each sink receives data from the neighbouring sensors.
 To reduce hardware costs and power consumption, these sinks are resource
 constrained: no hard disk, only a serial port connector and a ethernet
 or wireless local area network connection.
 Each sink can run GSN configured to only acquire data.
 
\end_layout

\begin_layout Standard
A GSN data processing server runs in the basement of the building or even
 in a remote location, possibly hosted in a colocation facility.
 This server knows about each of the data acquisition servers and registers
 to them as a data consumer.
 It will receive their data, analyzes the network packets, logs all erroneous
 packets in a separate database for off-line manual analysis and sends all
 statistics packets to the graph generator.
\end_layout

\begin_layout Standard
A third GSN server gets the refined data and also runs the Apache web server
 for performance reasons.
 It allows identified web users to see plots of the number of erroneous
 messages in the last 24 hours (for application debugging and traffic spoofing
 detection), plots with the number of openings for each door and the time
 at which they occured and the photos of the last 25 persons who entered
 the building.
 It also shows a zoomable satellite picture of the enterprise campus to
 locate more easily the possible source of intrusion.
\end_layout

\begin_layout Standard
An idea on how to configure GSN to do that is shown in Figure 
\begin_inset LatexCommand ref
reference "fig:Intrusion-detection-example"

\end_inset

.
 For the sake of simplicity, only one instance of each server type is represente
d.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Standard
\begin_inset Caption

\begin_layout Standard
\begin_inset LatexCommand label
name "fig:Intrusion-detection-example"

\end_inset

Intrusion detection example scenario
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename figures/gsn-config-3-servers.png
	lyxscale 25
	width 100line%

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Chapter
\begin_inset LatexCommand index
name "GSN Internals"

\end_inset

GSN Architecture
\end_layout

\begin_layout Section
Generalities
\end_layout

\begin_layout Standard
GSN is composed of three parts: data acquisition, data processing, and output
 dispatching (also called notification subsystem).
 Most users will probably focus on the second part, data processing.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Standard
\begin_inset Caption

\begin_layout Standard
GSN Architecture Overview
\end_layout

\end_inset


\end_layout

\begin_layout Standard

\hfill

\begin_inset Graphics
	filename figures/gsn-architecture.png
	width 100line%

\end_inset


\hfill
 
\end_layout

\end_inset


\end_layout

\begin_layout Section
Data Acquisition
\end_layout

\begin_layout Standard
Before filtering and processing data, GSN needs to receive it.
 GSN considers two types of data sources: event-based and polling-based.
 In the first case, data is sent by the source and a GSN method is called
 when it arrives.
 Serial ports, network (TCP or UDP) connections, wireless webcams fall in
 this case.
 In the latter one, GSN periodically asks the source for new data.
 This is the case of an RSS feed or a POP3 email account.
\end_layout

\begin_layout Subsection
GSN Wrappers
\begin_inset LatexCommand index
name "Wrappers"

\end_inset


\end_layout

\begin_layout Standard
GSN can receive data from various data sources.
 This is done by using so called 
\emph on
wrappers
\emph default
.
 They are used to encapsulate the data received from the data source into
 the standard GSN data model, called a 
\emph on
StreamElement
\emph default
.
 A StreamElement is an object representing a row of a SQL table.
\end_layout

\begin_layout Standard
Each wrapper is a Java class that extends the 
\emph on
AbstractWrapper
\emph default
 parent class.
 Usually a wrapper initializes a specialized third-party library in its
 constructor.
 It also provides a method which is called each time the library receives
 data from the monitored device.
 This method will extract the interesting data, optionnally parse it, and
 create one or more StreamElement(s) with one or more columns.
 From this point on, the received data has been mapped to a SQL data structure
 with fields that have a name and a type.
 GSN is then able to filter this using its enhanced SQL-like syntax.
 You will learn more about that in section 
\begin_inset LatexCommand ref
reference "sub:The-SQL-syntax"

\end_inset

.
\end_layout

\begin_layout Standard
A wrapper is implemented in a Java class.
 For simplicity, GSN uses short names to refer to these wrappers.
 These associations are defined in the file 
\family typewriter
conf/wrappers.properties
\family default
.
 For now on it is assumed that you use the default names provided at installatio
n time.
\end_layout

\begin_layout Standard
Each of the standard wrappers is described below with some documentation
 on how to use it.
\end_layout

\begin_layout Standard
You can refer to Table 
\begin_inset LatexCommand pageref
reference "tab:Description-of-Wrappers"

\end_inset

 for a quick overview of the available wrappers.
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Standard
\begin_inset Caption

\begin_layout Standard
\begin_inset LatexCommand label
name "tab:Description-of-Wrappers"

\end_inset

Description of GSN wrappers
\end_layout

\end_inset


\end_layout

\begin_layout Standard

\hfill

\begin_inset Tabular
<lyxtabular version="3" rows="10" columns="4">
<features>
<column alignment="center" valignment="top" leftline="true" width="8page%">
<column alignment="center" valignment="top" leftline="true" width="0">
<column alignment="center" valignment="top" leftline="true" width="25page%">
<column alignment="center" valignment="top" leftline="true" rightline="true" width="0">
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Wrapper
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Short name
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Description
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
page
\end_layout

\end_inset
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Remote wrapper
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
remote
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Enables a virtual sensor to use another virtual sensor as its data source.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
\begin_inset LatexCommand pageref
reference "sub:Remote-Wrapper"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
TinyOS 1.x
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
tinyos1x
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Communicates with any device running the TinyOS 1.x operating system.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
\begin_inset LatexCommand pageref
reference "sub:TinyOS-1.x"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
TinyOS 2.x
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
tinyos2x
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Communicates with any device running the TinyOS 2.x operating system.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
\begin_inset LatexCommand pageref
reference "sub:TinyOS-2.x"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Serial Wrapper
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
serial
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Reads and send data on the serial port (RS-232 interface), real or virtual
 (e.g.
 Serial Port Profile over BlueTooth wireless link).
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
\begin_inset LatexCommand pageref
reference "sub:Serial-Wrapper"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
UDP Wrapper
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
udp
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Opens a UDP socket on a configured port and reads data on it.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
\begin_inset LatexCommand pageref
reference "sub:UDP-Wrapper"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
System Time
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
system-time
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Generates events from system clock every 
\emph on
t
\emph default
 milliseconds, with the system time at which the event was generated.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
\begin_inset LatexCommand pageref
reference "sub:System-Time"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
HTTP Get handler
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
http-get
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Polls sensor readings from a remote web server (e.g., AXIS wireless camera).
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
\begin_inset LatexCommand pageref
reference "sub:Http-wrapper"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
USB Webcams
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
usb-cam
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Polls a USB camera
\begin_inset Foot
status collapsed

\begin_layout Standard
Only the OV518 chipset is currently supported.
\end_layout

\end_inset

 periodically to grab a picture.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
\begin_inset LatexCommand pageref
reference "sub:USB-Webcams"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Memory Monitor
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
memory-usage
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Periodically generates memory usage statistics.
 Current version gives information on Heap, non-heap and the number of objects
 awaiting finalization in the virtual machine running GSN.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
\begin_inset LatexCommand pageref
reference "sub:Memory-Monitor"

\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\hfill

\end_layout

\end_inset


\end_layout

\begin_layout Subsection
\begin_inset LatexCommand index
name "Remote Wrapper"

\end_inset

Remote Wrapper
\begin_inset LatexCommand label
name "sub:Remote-Wrapper"

\end_inset


\end_layout

\begin_layout Standard
A virtual sensor can get data from another virtual sensor (Inter-GSN communicati
on).
 If this other virtual sensor is running on another GSN server, the communicatio
n between these two servers is made with the XML-RPC protocol.
 This means that you can actually feed data to GSN from your own custom
 software written in any language supporting XML-RPC.
 
\end_layout

\begin_layout Standard
The Remote Wrapper is a special wrapper that allows GSN to treat a remote
 virtual sensor (located on anthor machine in the network) as a data source
 for another virtual sensor.
 This data source can be configured on the same GSN server (in this case,
 we say that they are defined in the same container), or it can be run on
 another computer (hence the ip and port parameters of this wrapper).
 
\end_layout

\begin_layout Standard
This wrapper takes three mandatory parameters.
 
\family typewriter
HOST
\family default
 specifies the network address (DNS name or IP address) on which is running
 the GSN instance we want to connect to (when connecting to the same GSN
 instance, use the 
\family typewriter
localhost
\family default
 name or the loopback address 
\family typewriter
127.0.0.1
\family default
).
 
\family typewriter
PORT
\family default
 is the port number on which this GSN instance is listening (the standard
 port for GSN is 
\family typewriter
22001
\family default
).
 
\family typewriter
name
\family default
 is the name of the virtual sensor to which we want to connect.
 Note that this wrapper uses the very same XML-RPC style communication used
 by GSN.
\end_layout

\begin_layout Standard
\begin_inset Float table
placement h
wide false
sideways false
status open

\begin_layout Standard
\begin_inset Caption

\begin_layout Standard
Parameters for Remote wrapper
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Tabular
<lyxtabular version="3" rows="4" columns="5">
<features>
<column alignment="center" valignment="top" leftline="true" width="0">
<column alignment="center" valignment="top" leftline="true" width="15line%">
<column alignment="center" valignment="top" leftline="true" width="0">
<column alignment="center" valignment="top" leftline="true" rightline="true" width="30line%">
<column alignment="center" valignment="top" rightline="true" width="0">
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Parameter name
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Type
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Mandatory
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Description
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Default
\end_layout

\end_inset
</cell>
</row>
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
HOST
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Network name or IP address
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Yes
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
The network address on which the GSN instance that we want to connect to
 is running.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
None
\end_layout

\end_inset
</cell>
</row>
<row bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
PORT
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Integer between 1 and 65535
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Yes
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
The TCP port on which the GSN instance that we want to connect to is running.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
None
\end_layout

\end_inset
</cell>
</row>
<row bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
name
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
String
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Yes
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
The name of the virtual sensor name we want to get data from.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
None
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Local Wrapper (InVMPipeWrapper)
\end_layout

\begin_layout Standard
This is a special form of the Remote wrapper which always points to the
 GSN instance running on the same machine.
 Using this wrapper you can combine two or more virtual sensors together
 and make a chain of data processing.
 For using this wrapper both virtual sensor should be located on a very
 same GSN instance.
 This wrapper accepts only one parameter which is called 
\begin_inset Quotes eld
\end_inset

name
\begin_inset Quotes erd
\end_inset

 and points to the name of the virtual sensor acting as a data source.
 Note that if both virtual sensors are on the same machine you can use both
 the remote and local wrapper but the latter perform much faster than the
 former.
 The remote wrapper suffers from the network communication overhead while
 the local wrapper is desgined to bypass this layer hence making it faster.
\end_layout

\begin_layout Subsection
\begin_inset LatexCommand index
name "TinyOS 1.x"

\end_inset

TinyOS
\begin_inset LatexCommand label
name "sub:TinyOS-1.x"

\end_inset


\begin_inset LatexCommand index
name "TinyOS 2.x"

\end_inset


\begin_inset LatexCommand label
name "sub:TinyOS-2.x"

\end_inset


\end_layout

\begin_layout Standard
With default GSN installation we provide sample wrappers to interact with
 TinyOS based sensor networks (both version 1.x and 2.x).
 The TinyOS wrapper is actually a java program that interacts with the serial
 forwarder (provided by TinyOS distribution) which inturn presents a sensor
 network.
 In order to use the TinyOS wrapper with a sensor network you need to first
 generate the java representation of the message structures used in the
 network (in TinyOS they are defined in the .h files).
 NesC language provides a tool called 
\begin_inset Quotes eld
\end_inset

mig
\begin_inset Quotes erd
\end_inset

 (message interface generator for nesC) for this purpose.
 The tool has a standard man page documentation in addition to being described
 in the lession 4 of the TinyOS 2 tutorial.
 
\end_layout

\begin_layout Standard
Note for TinyOS 1.x users, due to strange java package management in TinyOS
 2.x distribution, both TinyOS 1.x and 2.x are using very same package structures
 and class names which generates conflict when you have both TinyOS1.x and
 2.x jar files in your classpath (which is the case for GSN).
 To resolve this, you need to edit the generated message file and modify
 it so that it only uses class files from the TinyOS 1.x (all classes must
 be imported from net.tinyos1x package).
\end_layout

\begin_layout Standard
Once you generated the Java representation of the communication message
 structures, you need to write a wrapper class for your message.
 Assuming you have a message class called MyMessage which has three fields,
 node_id, temperature and light, here is a sample wrapper class to bind
 your network with GSN :
\end_layout

\begin_layout Verse
//import net.tinyos1x.message.Message; // Only for TinyOS 1.x
\end_layout

\begin_layout Verse
//import net.tinyos1x.message.MessageListener; // Only for TinyOS 1.x
\end_layout

\begin_layout Verse
//import net.tinyos1x.message.MoteIF; // Only for TinyOS 1.x
\end_layout

\begin_layout Verse
import net.tinyos.message.Message; // Only for TinyOS 2.x
\end_layout

\begin_layout Verse
import net.tinyos.message.MessageListener; // Only for TinyOS 2.x
\end_layout

\begin_layout Verse
import net.tinyos.message.MoteIF; // Only for TinyOS 2.x
\end_layout

\begin_layout Verse
import net.tinyos.packet.BuildSource; // Only for TinyOS 2.x
\end_layout

\begin_layout Verse
import net.tinyos.packet.PhoenixSource; // Only for TinyOS 2.x
\end_layout

\begin_layout Verse
public class MyWrapper extends AbstractWrapper implements MessageListener
 { 
\end_layout

\begin_layout Verse
private final DataField [] structure = new DataField[] {
\end_layout

\begin_layout Verse
new DataField("node_id","int","The node id the mote."),
\end_layout

\begin_layout Verse
new DataField("temperature","double","Presents the temperature sensor."),
\end_layout

\begin_layout Verse
new DataField("light","double","Presents the light sensor.")
\end_layout

\begin_layout Verse
}; 
\end_layout

\begin_layout Verse
public boolean initialize ( ) { 
\end_layout

\begin_layout Verse
AddressBean addressBean = getActiveAddressBean( );
\end_layout

\begin_layout Verse
String host = addressBean.getPredicateValue( "host" ); // The ip of the machine
 running serial forwarder.
\end_layout

\begin_layout Verse
if ( host == null || host.trim( ).length( ) == 0 ) {
\end_layout

\begin_layout Verse
logger.warn( "The >host< parameter is missing from the RemoteWrapper wrapper."
 );
\end_layout

\begin_layout Verse
return false; //initialization failed, the host name is not provided in
 the parameters.
\end_layout

\begin_layout Verse
}
\end_layout

\begin_layout Verse
int port; // The port of the machine running serial forwarder.
\end_layout

\begin_layout Verse
String portRaw = addressBean.getPredicateValue( "port" );
\end_layout

\begin_layout Verse
if ( portRaw == null || portRaw.trim( ).length( ) == 0 )
\end_layout

\begin_layout Verse
{ logger.warn( "The >port< parameter is missing from the RemoteWrapper wrapper."
 );
\end_layout

\begin_layout Verse
return false;// initialization failed, the port no.
 is not provided in the parameters.
\end_layout

\begin_layout Verse
} try {
\end_layout

\begin_layout Verse
port = Integer.parseInt( portRaw ); 
\end_layout

\begin_layout Verse
if ( port > 65000 || port <= 0 ) throw new Exception( "Bad port No" + port
 );
\end_layout

\begin_layout Verse
} catch ( Exception e ) { 
\end_layout

\begin_layout Verse
logger.warn( "The >port< parameter is not a valid integer for the RemoteWrapper
 wrapper." ); 
\end_layout

\begin_layout Verse
return false; // initialization failed, the port no.
 is not valid.
\end_layout

\begin_layout Verse
}
\end_layout

\begin_layout Verse
if ( logger.isDebugEnabled( ) )
\end_layout

\begin_layout Verse
logger.debug( "The SFWrapperDS connects to the Serial Forwarder interface
 at *" + host + ":" + port + "*" ); 
\end_layout

\begin_layout Verse
setName( "TinyOS-My-Wrapper") ;
\end_layout

\begin_layout Verse
try {
\end_layout

\begin_layout Verse
PhoenixSource reader=BuildSource.makePhoenix( BuildSource.makeSF( host , port
 ) , null );// Only for TinyOS 2.x
\end_layout

\begin_layout Verse
reader.start( ); // TinyOS 2.x
\end_layout

\begin_layout Verse
moteif = new MoteIF( reader ); // Only for TinyOS 2.x
\end_layout

\begin_layout Verse
// moteif = MoteIF (host,port); // Uncomment this, only for TinyOS 1.x
\end_layout

\begin_layout Verse
} catch ( Exception e ) {
\end_layout

\begin_layout Verse
logger.error( e.getMessage( ) , e );
\end_layout

\begin_layout Verse
return false; // Serial Forwarder client couldn't establish the connection.
\end_layout

\begin_layout Verse
}
\end_layout

\begin_layout Verse
moteif.registerListener( new MyMessage( ) , this );
\end_layout

\begin_layout Verse
return true; //initialization is successful.
\end_layout

\begin_layout Verse
}
\end_layout

\begin_layout Verse
public synchronized void finalize ( ) {
\end_layout

\begin_layout Verse
moteif.deregisterListener( new SensorScopeDataMsg( ) , this );
\end_layout

\begin_layout Verse
}
\end_layout

\begin_layout Verse
public void messageReceived ( int toAddr , Message message ) {
\end_layout

\begin_layout Verse
MyMessage msg = (MyMessage) message;
\end_layout

\begin_layout Verse
// (If needed) extract/parse/convert the sensor measurements to some meaningful
 values
\end_layout

\begin_layout Verse
postStreamElement( nodeid,sensor1,sensor2 );
\end_layout

\begin_layout Verse
}
\end_layout

\begin_layout Verse
public DataField [] getOutputFormat ( ) { return structure; }
\end_layout

\begin_layout Subsection
\begin_inset LatexCommand index
name "Serial Wrapper"

\end_inset

Serial Wrapper
\begin_inset LatexCommand label
name "sub:Serial-Wrapper"

\end_inset


\end_layout

\begin_layout Standard
Todo : Jaggi has added several options to this wrapper, I'll combine them
 in a few days.
\end_layout

\begin_layout Standard

\end_layout

\begin_layout Standard
The short name of this wrapper is 
\family typewriter
serial
\family default
.
 
\end_layout

\begin_layout Standard
The mandatory parameters are 
\family typewriter
HOST
\family default
, 
\family typewriter
PORT
\family default
 and 
\family typewriter
serialport
\family default
.
 The latest one specifies on which serial port the wrapper should listen.
 The syntax is platform dependent: on Windows systems it will be 
\family typewriter
COM1
\family default
, 
\family typewriter
COM2
\family default
...
 and on Unix systems this will be 
\family typewriter
/dev/ttyS0
\family default
, 
\family typewriter
/dev/ttyS1
\family default
...
\end_layout

\begin_layout Standard
In its default mode of operation, each time it receives a byte sequence,
 it will be published in a StreamElement under the name 
\family typewriter
RAW_PACKET(varchar)
\family default
 and the type 
\family typewriter
BINARY
\family default
.
 It is up to the virtual sensor getting data from the wrapper to analyze
 the meaning of the received bytes.
\end_layout

\begin_layout Standard
If the optional parameter 
\emph on
inputseparator
\emph default
 is defined, then the received data is not immediately published.
 Instead, the wrapper splits the data using the parameter value as a separator.
 The separator is never published.
 If there is remaining data after the last separator, it is stored in a
 temporary buffer.
 The next byte sequence to be received by the wrapper will be concatenated
 to the temporary buffer before attempting to split it.
\end_layout

\begin_layout Standard
As an example, if the separator is 
\family typewriter
:
\family default
 and the received data is 
\family typewriter
abc:def:g
\family default
 , then two StreamElements (two rows) are generated.
 The first one contains 
\family typewriter
abc
\family default
 in the 
\family typewriter
RAW_PACKET
\family default
 field and the other one contains 
\family typewriter
def
\family default
.
 
\family typewriter
g
\family default
 is stored in the temporary buffer.
 Imagine that the wrapper now receives 
\family typewriter
hijklm:
\family default
 .
 Then only one StreamElement will be generated, with the value 
\family typewriter
ghijklm
\family default
 and the temporary buffer will be emptied.
\end_layout

\begin_layout Standard
\begin_inset Float table
placement h
wide false
sideways false
status open

\begin_layout Standard
\begin_inset Caption

\begin_layout Standard
Parameters for serial wrapper
\end_layout

\end_inset


\end_layout

\begin_layout Standard

\hfill

\begin_inset Tabular
<lyxtabular version="3" rows="4" columns="5">
<features>
<column alignment="center" valignment="top" leftline="true" width="0">
<column alignment="center" valignment="top" leftline="true" width="0">
<column alignment="center" valignment="top" leftline="true" width="0">
<column alignment="center" valignment="top" leftline="true" rightline="true" width="30line%">
<column alignment="center" valignment="top" rightline="true" width="0">
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Parameter name
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Type
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Mandatory
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Description
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Default
\end_layout

\end_inset
</cell>
</row>
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
serialport
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
String
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Yes
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
The serial port on which the wrapper should listen to.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
None
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
baudrate
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Number
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
No
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
The speed at which the data is arriving on the port, in bits per second.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
9600
\end_layout

\end_inset
</cell>
</row>
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
inputseparator
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
String
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
No
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
If this parameter is defined, the serial port wrapper will split incoming
 data using this value as a separator.
 The separator is not published.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
None
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\hfill

\end_layout

\end_inset

 
\end_layout

\begin_layout Subsection
\begin_inset LatexCommand index
name "UDP Wrapper"

\end_inset

UDP Wrapper
\begin_inset LatexCommand label
name "sub:UDP-Wrapper"

\end_inset


\end_layout

\begin_layout Standard
The short name of this wrapper is 
\family typewriter
udp
\family default
.
 It allows GSN to receive arbitrary data on a UDP port of the machine on
 which it is running.
 There is only one parameter, named 
\family typewriter
port
\family default
.
 Received data is published under the type 
\family typewriter
BINARY
\family default
 and the name 
\family typewriter
RAW_PACKET
\family default
.
\end_layout

\begin_layout Standard
\begin_inset Float table
placement h
wide false
sideways false
status open

\begin_layout Standard
\begin_inset Caption

\begin_layout Standard
Parameters for UDP wrapper
\end_layout

\end_inset


\end_layout

\begin_layout Standard

\hfill

\begin_inset Tabular
<lyxtabular version="3" rows="2" columns="5">
<features>
<column alignment="center" valignment="top" leftline="true" width="0">
<column alignment="center" valignment="top" leftline="true" width="15line%">
<column alignment="center" valignment="top" leftline="true" width="0">
<column alignment="center" valignment="top" leftline="true" rightline="true" width="30line%">
<column alignment="center" valignment="top" rightline="true" width="0">
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Parameter name
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Type
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Mandatory
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Description
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Default
\end_layout

\end_inset
</cell>
</row>
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
port
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Integer between 1 and 65535
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Yes
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
The UDP port on which the wrapper should listen to.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
None
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\hfill

\end_layout

\end_inset


\end_layout

\begin_layout Subsection
\begin_inset LatexCommand index
name "System Time"

\end_inset

System Time
\begin_inset LatexCommand label
name "sub:System-Time"

\end_inset


\end_layout

\begin_layout Standard
The short name for this wrapper is 
\family typewriter
system-time
\family default
.
 It generates a StreamElement object every 
\family typewriter
clock_periods
\family default
 milliseconds, with the timestamp at which the object was generated.
\end_layout

\begin_layout Standard
\begin_inset Float table
placement h
wide false
sideways false
status open

\begin_layout Standard
\begin_inset Caption

\begin_layout Standard
Parameters for System Time wrapper
\end_layout

\end_inset


\end_layout

\begin_layout Standard

\hfill

\begin_inset Tabular
<lyxtabular version="3" rows="2" columns="5">
<features>
<column alignment="center" valignment="top" leftline="true" width="0">
<column alignment="center" valignment="top" leftline="true" width="15line%">
<column alignment="center" valignment="top" leftline="true" width="0">
<column alignment="center" valignment="top" leftline="true" rightline="true" width="30line%">
<column alignment="center" valignment="top" rightline="true" width="0">
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Parameter name
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Type
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Mandatory
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Description
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Default
\end_layout

\end_inset
</cell>
</row>
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
clock_periods
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Integer
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
No
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Time interval between two events.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
1000 ms
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\hfill

\end_layout

\end_inset


\end_layout

\begin_layout Subsection
\begin_inset LatexCommand index
name "Axis Wireless Camera"

\end_inset

Http-Get Wrapper Wireless Camera
\begin_inset LatexCommand label
name "sub:Http-wrapper"

\end_inset


\end_layout

\begin_layout Standard
This wrapper polls a sensor data from a web server using http get requests.
 This can be used with any kind of sensor providing access to its sensor
 data via a web server.
 As a sample, we provide a netcam virtual sensor which uses this wrapper
 to interact with Axis 206W networked camera.
 This wrapper has the following parameters : 
\end_layout

\begin_layout Standard
\begin_inset Float table
placement h
wide false
sideways false
status open

\begin_layout Standard
\begin_inset Caption

\begin_layout Standard
Parameters for Http Get wrapper
\end_layout

\end_inset


\end_layout

\begin_layout Standard

\hfill

\begin_inset Tabular
<lyxtabular version="3" rows="3" columns="5">
<features>
<column alignment="center" valignment="top" leftline="true" width="0">
<column alignment="center" valignment="top" leftline="true" width="15line%">
<column alignment="center" valignment="top" leftline="true" width="0">
<column alignment="center" valignment="top" leftline="true" rightline="true" width="30line%">
<column alignment="center" valignment="top" leftline="true" rightline="true" width="0">
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Parameter name
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Type
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Mandatory
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Description
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Default
\end_layout

\end_inset
</cell>
</row>
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
rate
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Integer
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
No
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Time interval between two events.
\end_layout

\end_inset
</cell>
<cell multicolumn="1" alignment="center" valignment="top" topline="true" bottomline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
2000 ms
\end_layout

\end_inset
</cell>
</row>
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
url
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
String
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Yes
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
The URL of the web server serving sensor readings.
 Becareful about the especial characters in XML.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
N/A
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\hfill

\end_layout

\end_inset


\end_layout

\begin_layout Subsection
\begin_inset LatexCommand index
name "USB Webcams"

\end_inset

USB Webcams
\begin_inset LatexCommand label
name "sub:USB-Webcams"

\end_inset


\end_layout

\begin_layout Standard
Because of a license incompatibility, the wrapper for OV511/518 wired usb
 cameras is not distributed with the standard installation of GSN.
\end_layout

\begin_layout Standard
You can find the wrapper (the java files) from the svn repository of GSN
 at 
\begin_inset LatexCommand htmlurl
target "http://www.sourceforge.net/projects/gsn"

\end_inset

.
\end_layout

\begin_layout Standard
To use the ovcam511/518 wrapper with linux: 
\end_layout

\begin_layout Standard
1.
 Get the driver from 
\begin_inset LatexCommand htmlurl
target "http://ovcam.org/ov511/"

\end_inset

, compile it and install it.
\end_layout

\begin_layout Standard
2.
 Download the Java Media Framework for your platform and install it.
 At this stage, the JMF should detect your webcam.
 If it does not, most probably the ov511 driver was not correctly installed.
 Please refer to the documentation of your distribution.
\end_layout

\begin_layout Standard
3.
 Once the webcam is detected by the JMF, On linux : sudo rmmod ov511; sudo
 modprobe ovcamchip;sudo modprobe ov511
\end_layout

\begin_layout Standard
4.
 The system environment or the java execution environment (in Eclipse) must
 be configured:
\end_layout

\begin_layout LyX-Code
LD_LIBRARY_PATH=/home/ali/download/JMF-2.1.1e/lib:
\end_layout

\begin_layout LyX-Code
  /usr/local/java/jdk1.5.0/jre/lib/i386:
\end_layout

\begin_layout LyX-Code
  /usr/local/java/jdk1.5.0/jre/lib/i386/client:
\end_layout

\begin_layout LyX-Code
  /usr/local/java/jdk1.5.0/jre/lib/i386/xawt
\end_layout

\begin_layout LyX-Code
LD_PRELOAD=/usr/local/java/jdk1.5.0/jre/lib/i386/libjawt.so
\end_layout

\begin_layout Standard
The short name for this wrapper is 
\family typewriter
usb-cam
\family default
.
 You can configure it to run in live mode or not (mandatory parameter 
\family typewriter
live-view
\family default
).
\end_layout

\begin_layout Standard
\begin_inset Float table
placement h
wide false
sideways false
status open

\begin_layout Standard
\begin_inset Caption

\begin_layout Standard
Parameters for OV511 USB webcams
\end_layout

\end_inset


\end_layout

\begin_layout Standard

\hfill

\begin_inset Tabular
<lyxtabular version="3" rows="2" columns="5">
<features>
<column alignment="center" valignment="top" leftline="true" width="0">
<column alignment="center" valignment="top" leftline="true" width="15line%">
<column alignment="center" valignment="top" leftline="true" width="0">
<column alignment="center" valignment="top" leftline="true" rightline="true" width="20line%">
<column alignment="center" valignment="top" rightline="true" width="0">
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Parameter name
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Type
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Mandatory
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Description
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Default
\end_layout

\end_inset
</cell>
</row>
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
live-view
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Boolean (as String: 
\family typewriter
true
\family default
 or 
\family typewriter
false
\family default
)
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Yes
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Sets the web cam in live mode.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
None.
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\hfill

\end_layout

\end_inset


\end_layout

\begin_layout Subsection
\begin_inset LatexCommand index
name "Memory Monitor"

\end_inset

Memory Monitor
\begin_inset LatexCommand label
name "sub:Memory-Monitor"

\end_inset


\end_layout

\begin_layout Standard
This wrapper queries periodically the virtual machine in which gsn is running.
 It produces statistics on memory usage.
 The query rate can be configured with the optional parameter rate.
 The short name for this wrapper is memory-usage.
\end_layout

\begin_layout Standard
\begin_inset Float table
placement h
wide false
sideways false
status open

\begin_layout Standard
\begin_inset Caption

\begin_layout Standard
Parameters for memory monitoring wrapper
\end_layout

\end_inset


\end_layout

\begin_layout Standard

\hfill

\begin_inset Tabular
<lyxtabular version="3" rows="2" columns="5">
<features>
<column alignment="center" valignment="top" leftline="true" width="15line%">
<column alignment="center" valignment="top" leftline="true" width="15line%">
<column alignment="center" valignment="top" leftline="true" width="0">
<column alignment="center" valignment="top" leftline="true" rightline="true" width="20line%">
<column alignment="center" valignment="top" rightline="true" width="0">
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Parameter name
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Type
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Mandatory
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Description
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Default
\end_layout

\end_inset
</cell>
</row>
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
rate
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Integer
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
No
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Defines the rate at which data is produced.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
1000
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\hfill

\end_layout

\end_inset


\end_layout

\begin_layout Section
Data filtering and processing
\end_layout

\begin_layout Standard
GSN provides two complementary mechanisms to work on your data.
\end_layout

\begin_layout Standard
The first one is based on a SQL syntax enhanced with specialized semantics
 for timed sliding windows and event counting.
\end_layout

\begin_layout Standard
The second one allows to manipulate data with specialized programs called
 
\emph on
virtual sensors
\emph default
.
 GSN comes with a library of virtual sensors that you can use without programmin
g.
 If you have more sophisticated needs, you can write your own virtual sensors
 (See the Developer's Guide, chapter 
\begin_inset LatexCommand ref
reference "cha:Writing-a-VS"

\end_inset

).
\end_layout

\begin_layout Standard
GSN always processes the data according to a virtual sensor configuration.
 If you only want to use the SQL filtering mechanism, without any data transform
ation, you can use the 
\emph on
BridgeVirtualSensor
\emph default
 (see section 
\begin_inset LatexCommand ref
reference "sub:BridgeVirtualSensor"

\end_inset

).
\end_layout

\begin_layout Standard
If you don't want to use the SQL filtering mechanism, simply select all
 data from the wrapper.
\end_layout

\begin_layout Subsection
The SQL syntax
\begin_inset LatexCommand label
name "sub:The-SQL-syntax"

\end_inset


\end_layout

\begin_layout Subsection
Virtual Sensors
\begin_inset LatexCommand index
name "Virtual Sensors"

\end_inset


\end_layout

\begin_layout Subsubsection
Introduction
\end_layout

\begin_layout Standard
Virtual sensors are small Java programs that register to GSN with a specific
 SQL query for their data input.
 This query is configured by the user.
 When GSN receives data that matches the filter at the entry of a virtual
 sensor, this data is sent to the virtual sensor, which usually performs
 some sort of operation depending of the received data, and finally publishes
 some data (it may also produce nothing).
\end_layout

\begin_layout Standard
Virtual sensors are configured in the virtual-sensors directory.
 You can edit the configuration of a virtual sensor online while GSN is
 running, because GSN periodically scans this directory for updates.
 This can be very useful when you are learning how to use GSN: you can immediate
ly see the effect of modifying a query.
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Standard
\begin_inset Caption

\begin_layout Standard
\begin_inset LatexCommand label
name "tab:List-of-VS"

\end_inset

GSN built-in virtual sensors
\end_layout

\end_inset


\end_layout

\begin_layout Standard

\hfill

\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="4">
<features>
<column alignment="center" valignment="top" leftline="true" width="8page%">
<column alignment="center" valignment="top" leftline="true" width="8page%">
<column alignment="center" valignment="top" leftline="true" width="30line%">
<column alignment="center" valignment="top" leftline="true" rightline="true" width="7line%">
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Virtual Sensor
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Class name
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Description
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
page
\end_layout

\end_inset
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Bridge
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
gsn.vsensor.
 BridgeVirtualSensor
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
This VS only acts as a bridge and does not modify data.
 It can be used to forward data directly from a wrapper to the notification
 system, or to only use SQL filtering.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
\begin_inset LatexCommand pageref
reference "sub:BridgeVirtualSensor"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Chart
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
gsn.vsensor.
 ChartVirtualSensor
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Generates graphs of received data.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
\begin_inset LatexCommand pageref
reference "ChartVirtualSensor"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Stream Exporter
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
gsn.vsensor.
 StreamExporterVirtualSensor
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Exports received data to any supported database.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
\begin_inset LatexCommand pageref
reference "sub:Stream-Exporter"

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Web Interaction
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
gsn.vsensor.
\end_layout

\begin_layout Standard
WebInter\SpecialChar \-
active\SpecialChar \-
Virtu\SpecialChar \-
al\SpecialChar \-
Sensor
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\end_layout

\end_inset
</cell>
</row>
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Host Controller Interface Graphical User Interface
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
gsn.vsensor.
\end_layout

\begin_layout Standard
HCI\SpecialChar \-
Proto\SpecialChar \-
col\SpecialChar \-
GUIVS
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
A Graphical User Interface for sending commands to a hardware device.
 Two protocols are currently supported.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\hfill

\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
The virtual-sensor xml configuration file
\end_layout

\begin_layout Standard
A virtual sensor configuration file starts with the 
\family typewriter
virtual-sensor
\family default
 tag.
 It takes three parameters, 
\family typewriter
name
\family default
, 
\family typewriter
priority
\family default
 and 
\family typewriter
password
\family default
.
 The first one is mandatory and arbitrary (the only constraint is that the
 name should be unique in this GSN configuration), and the two others are
 optional.
 0 is the highest priority and 20 is the lowest.
 The default priority is 10.
\end_layout

\begin_layout Standard
The first tag inside virtual-sensor is usually 
\family typewriter
processing-class
\family default
.
 The first tag inside this group is 
\family typewriter
class-name
\family default
, and gives the class name of the Virtual Sensor to be used in this configuratio
n.
 After this comes an optional 
\family typewriter
init-params
\family default
 section.
\end_layout

\begin_layout Standard
We will work with an example to better understand these concepts.
 We present here a configuration for the ChartVirtualSensor that gets data
 from another virtual sensor, named 
\family typewriter
MemoryMonitorVS
\family default
.
 These two configurations can be found in the default installation of GSN
 under the names 
\emph on
memoryDataVS.xml
\emph default
 and 
\emph on
memoryPlotVS.xml
\emph default
.
\end_layout

\begin_layout LyX-Code

\end_layout

\begin_layout LyX-Code
<virtual-sensor name="MemoryPlotVS" >
\end_layout

\begin_layout LyX-Code
  <processing-class>
\end_layout

\begin_layout LyX-Code
     <class-name>gsn.vsensor.ChartVirtualSensor</class-name>
\end_layout

\begin_layout LyX-Code
        <init-params>
\end_layout

\begin_layout LyX-Code
            <param name="input-Stream">DATA</param>
\end_layout

\begin_layout LyX-Code
            <param name="title">GSN Memory Usage</param>
\end_layout

\begin_layout LyX-Code
            <param name="type">ANY</param>
\end_layout

\begin_layout LyX-Code
            <param name="height">200</param>
\end_layout

\begin_layout LyX-Code
            <param name="width">300</param>
\end_layout

\begin_layout LyX-Code
            <param name="vertical-axis">Sensor Readings</param>
\end_layout

\begin_layout LyX-Code
            <param name="history-size">100</param>
\end_layout

\begin_layout LyX-Code
      </init-params>
\end_layout

\begin_layout LyX-Code
   <output-structure>
\end_layout

\begin_layout LyX-Code
     <field name="DATA" type="binary:image/jpeg"/> 
\end_layout

\begin_layout LyX-Code
   </output-structure>
\end_layout

\begin_layout LyX-Code
 </processing-class>
\end_layout

\begin_layout LyX-Code
 <description>My chart virtual sensor<description>
\end_layout

\begin_layout LyX-Code
 <life-cycle pool-size="10"/>
\end_layout

\begin_layout LyX-Code
 <addressing>
\end_layout

\begin_layout LyX-Code
   <predicate key="geographical">BC building EPFL</predicat>
\end_layout

\begin_layout LyX-Code
 </addressing>
\end_layout

\begin_layout LyX-Code
 <storage history-size="1" />
\end_layout

\begin_layout LyX-Code
 <streams>
\end_layout

\begin_layout LyX-Code
    <stream name="DATA" rate="100">
\end_layout

\begin_layout LyX-Code
      <source alias="source1" storage-size="1 sampling-rate="1">
\end_layout

\begin_layout LyX-Code
            <address wrapper="remote">
\end_layout

\begin_layout LyX-Code
               <predicate key="HOST">
\end_layout

\begin_layout LyX-Code
                  localhost
\end_layout

\begin_layout LyX-Code
               </predicate>
\end_layout

\begin_layout LyX-Code
               <predicate key="PORT">
\end_layout

\begin_layout LyX-Code
                  22001
\end_layout

\begin_layout LyX-Code
               </predicate>
\end_layout

\begin_layout LyX-Code
               <predicate key="NAME">
\end_layout

\begin_layout LyX-Code
                  MemoryMonitorVS
\end_layout

\begin_layout LyX-Code
               </predicate>
\end_layout

\begin_layout LyX-Code
            </address>
\end_layout

\begin_layout LyX-Code
            <query>
\end_layout

\begin_layout LyX-Code
              select HEAP,NON_HEAP,
\end_layout

\begin_layout LyX-Code
              PENDING_FINALIZATION_COUNT,TIMED
\end_layout

\begin_layout LyX-Code
              from wrapper
\end_layout

\begin_layout LyX-Code
            </query>
\end_layout

\begin_layout LyX-Code
         </source>
\end_layout

\begin_layout LyX-Code
         <query>
\end_layout

\begin_layout LyX-Code
          select * from source1
\end_layout

\begin_layout LyX-Code
         </query>
\end_layout

\begin_layout LyX-Code
       </stream>
\end_layout

\begin_layout LyX-Code
   </streams>
\end_layout

\begin_layout LyX-Code
</virtual-sensor>
\end_layout

\begin_layout Standard
Let us analyze this long file piece by piece.
 The first part defines which class to use and configures it:
\end_layout

\begin_layout LyX-Code
<processing-class>
\end_layout

\begin_layout LyX-Code
    <class-name>gsn.vsensor.ChartVirtualSensor</class-name>
\end_layout

\begin_layout LyX-Code
    <init-params>
\end_layout

\begin_layout LyX-Code
         <param name="input-Stream">DATA</param>
\end_layout

\begin_layout LyX-Code
         <param name="title">GSN Memory Usage</param>
\end_layout

\begin_layout LyX-Code
         <param name="type">ANY</param>
\end_layout

\begin_layout LyX-Code
         <param name="height">200</param>
\end_layout

\begin_layout LyX-Code
         <param name="width">300</param>
\end_layout

\begin_layout LyX-Code
         <param name="vertical-axis">Sensor Readings</param>
\end_layout

\begin_layout LyX-Code
         <param name="history-size">100</param>
\end_layout

\begin_layout LyX-Code
      </init-params>
\end_layout

\begin_layout LyX-Code
    <output-structure>
\end_layout

\begin_layout LyX-Code
      <field name="DATA" type="binary:image/jpeg"/> 
\end_layout

\begin_layout LyX-Code
    </output-structure>
\end_layout

\begin_layout LyX-Code
 </processing-class>
\end_layout

\begin_layout Standard
This virtual sensor generates graphs from the data it receives.
 We see here that the graph has a name, 
\begin_inset Quotes eld
\end_inset

GSN Memory Usage
\begin_inset Quotes erd
\end_inset

, that its size is 200*300 pixels, that the vertical axis shows the data
 readings and that the history-size is set to 100.
 This means that only the latest 100 received values will be plotted.
 The output-structure describes the data type produced by the virtual sensor.
 It defines a name and a type.
 Please consult the documentation of the virtual sensor that you want to
 use for more information.
 In this case the ChartVirtualSensor produces a its plots under the name
 
\begin_inset Quotes eld
\end_inset

DATA
\begin_inset Quotes erd
\end_inset

 which is a jpeg image hence type="binary:image/jpeg".
\end_layout

\begin_layout LyX-Code
<description>My chart virtual sensor</description>
\end_layout

\begin_layout LyX-Code
<life-cycle pool-size="2"/>
\end_layout

\begin_layout LyX-Code
<addressing>
\end_layout

\begin_layout LyX-Code
   <predicate key="geographical">...</predicate>
\end_layout

\begin_layout LyX-Code
</addressing>
\end_layout

\begin_layout Standard
The description field is shown to the user through the web interface, and
 you can also use it to help you remember what this specific configuration
 does.
\end_layout

\begin_layout Standard
The 
\family typewriter
life-cycle pool-size
\family default
 option is a performance parameter.
 It is usually safe to keep the default value.
 It defines the maximum number of instances of this virtual sensor (with
 this configuration).
 This can happen when the processing method of the virtual sensor takes
 a long time to complete, and / or when data arrives at high speed.
 If all instances are busy, then the data will be dropped.
\end_layout

\begin_layout Standard
The 
\family typewriter
addressing
\family default
 section is used to describe the location of the sensor (physical and logical
 address).
 This can be used to annotate a virtual sensor.
 In GSN we have two special addressing keys, latitude and longitude, which
 are used by GSN's web interface to visualize the phyiscal location of the
 virtual sensor on the google map interface.
 You can use them like below : 
\end_layout

\begin_layout Standard
<addressing>
\end_layout

\begin_layout Standard
<predicate key="type">mica sensor temperature light</predicate>
\end_layout

\begin_layout Standard
<predicate key="LATITUDE">37.4</predicate>
\end_layout

\begin_layout Standard
<predicate key="LONGITUDE">-122.1</predicate>
\end_layout

\begin_layout Standard
</addressing> 
\end_layout

\begin_layout Standard
Note that the addressing part is optional and can be omitted.
\end_layout

\begin_layout LyX-Code
<storage history-size="1" />
\end_layout

\begin_layout LyX-Code

\end_layout

\begin_layout Standard

\family typewriter
storage
\family default
's 
\family typewriter
history-size
\family default
 defines the number of streamElements produced by this virtual sensor that
 we want to store in the database.
 It does not impact the logical processing of data streams.
 If the history-size is not provided, GSN stores all the sensor data in
 the specified database (the gsn.xml file).
 Note that, if you use in memory database you must put upper limit on the
 history size otherwise the Java virtual machine will run out of memory
 at some point.
\end_layout

\begin_layout LyX-Code
<streams>
\end_layout

\begin_layout LyX-Code
<stream name="DATA" rate="100">
\end_layout

\begin_layout LyX-Code
<source alias="source1" storage-size="1" sampling-rate="1">
\end_layout

\begin_layout LyX-Code
<address wrapper="local">
\end_layout

\begin_layout LyX-Code
<predicate key="HOST">localhost</predicate>
\end_layout

\begin_layout LyX-Code
<predicate key="PORT">22001</predicate>
\end_layout

\begin_layout LyX-Code
<predicate key="NAME">MemoryMonitorVS</predicate>
\end_layout

\begin_layout LyX-Code
</address>
\end_layout

\begin_layout LyX-Code
<query>
\end_layout

\begin_layout LyX-Code
  select HEAP,NON_HEAP,
\end_layout

\begin_layout LyX-Code
    PENDING_FINALIZATION_COUNT,TIMED
\end_layout

\begin_layout LyX-Code
  from wrapper
\end_layout

\begin_layout LyX-Code
</query>
\end_layout

\begin_layout LyX-Code
</source>
\end_layout

\begin_layout LyX-Code
<query>select * from source1</query>
\end_layout

\begin_layout LyX-Code
</stream>
\end_layout

\begin_layout LyX-Code
</streams>
\end_layout

\begin_layout Standard
The streams section is very important.
 It tells GSN what data it should send to the virtual sensor you are using
 (how to feed the virtual sensor).
 A virtual sensor can receive data from one or more streams.
 In this case there is only one stream, that we name 
\family typewriter
DATA
\family default
.
 The 
\family typewriter
rate
\family default
 parameter is a performance tuning parameter.
 It defines the minimum interval in milliseconds between two calls to this
 virtual sensor.
 If there is data available for the virtual sensor in less than this value,
 then the data is silently dropped hence it is better to remove it when
 debuging.
\end_layout

\begin_layout Standard
This xml structure allows to perform 
\family typewriter
JOIN
\family default
 SQL operations on the incoming data streams, if more than one source is
 defined.
 In the stream queries, we can refer to a source by the value of 
\family typewriter
alias
\family default
 attribute of that source.
 The combination of 
\family typewriter
storage-size
\family default
 and 
\family typewriter
slide
\family default
 attributes defines a sliding window over the data.
 The 
\family typewriter
storage-size
\family default
 attribute specifies the size of the window and the 
\family typewriter
slide
\family default
 attibute specifies the sliding predicate.
 Both of these attributes can be either time-based or count-based.
 A time-based value can be specified by adding a 
\emph on
s
\emph default
, 
\emph on
m
\emph default
, or 
\emph on
h
\emph default
 character after the numeric value.
\end_layout

\begin_layout Standard
Here there is only one source, and we select everything from it in 
\family typewriter
select * from source1
\family default
.
 Our source gets its data from the 
\family typewriter
remote
\family default
 wrapper.
 This wrapper is used to get data from another virtual sensor.
 This other virtual sensor can be running in the local GSN instance or on
 a remote GSN server, hence the wrapper name.
 In this case we use the local wrapper which points to the local GSN instance.
 This wrapper gets one mandatory parameter : Name which is the name of the
 virtual sensor on the local box.
 We could also use the remote wrapper to do the same job (but less efficiently).
 For using the remote wrapper we need to provide three mandatory parameters:
 
\family typewriter
HOST
\family default
 and 
\family typewriter
PORT
\family default
 tells how to contact the GSN instance and 
\family typewriter
NAME
\family default
 specifies the virtual sensor from which we want to receive data from.
 The query specified after the addressing section is sent to the remote
 GSN server.
 Here we select some fields that are produced by the virtual sensor.
\end_layout

\begin_layout Subsubsection
\begin_inset LatexCommand index
name "Bridge Virtual Sensor"

\end_inset

Bridge Virtual Sensor
\begin_inset LatexCommand label
name "sub:BridgeVirtualSensor"

\end_inset


\end_layout

\begin_layout Standard
This virtual sensor immediately publishes any data that it receives without
 modifying it.
 The StreamElement object is not modified.
\end_layout

\begin_layout Standard
It does not take any parameter.
 Its main use is to filter and join sensor data with SQL without any other
 kind of post processing operation on the data.
 For using this wrapper the output structure of the virutal sensor must
 match strictly with the structure of the query.
 
\end_layout

\begin_layout Subsubsection
\begin_inset LatexCommand index
name "Chart Virtual Sensor"

\end_inset

Chart Virtual Sensor
\begin_inset LatexCommand label
name "ChartVirtualSensor"

\end_inset


\end_layout

\begin_layout Standard
This virtual sensor generates graphs from the data it receives.
 This is a complex VS because it can be computationally intensive, especially
 if it is frequently called.
 This virtual sensor using the JFreeChart library to plot the data.
\end_layout

\begin_layout Standard
\begin_inset Float table
placement h
wide false
sideways true
status open

\begin_layout Standard
\begin_inset Caption

\begin_layout Standard
Parameters for Plotter VS
\end_layout

\end_inset


\end_layout

\begin_layout Standard

\hfill

\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="5">
<features>
<column alignment="center" valignment="top" leftline="true" width="0">
<column alignment="center" valignment="top" leftline="true" width="15line%">
<column alignment="center" valignment="top" leftline="true" width="0">
<column alignment="center" valignment="top" leftline="true" rightline="true" width="30line%">
<column alignment="center" valignment="top" rightline="true" width="0">
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Parameter name
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Type
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Mandatory
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Description
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Default
\end_layout

\end_inset
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
input-stream
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
String
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Yes
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
The name of the stream to plot.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
None
\end_layout

\end_inset
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
title
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
String
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Yes
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
The graph title.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
None
\end_layout

\end_inset
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
vertical-axis
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
String
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Yes
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
A legend for the vertical axis.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
None
\end_layout

\end_inset
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
width
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Integer
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
No
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Graph width in pixels
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
640
\end_layout

\end_inset
</cell>
</row>
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
height
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Integer
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
No
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Graph height in pixels
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
480
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\hfill

\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection
Stream Exporter
\begin_inset LatexCommand index
name "Stream Exporter"

\end_inset


\begin_inset LatexCommand label
name "sub:Stream-Exporter"

\end_inset


\end_layout

\begin_layout Standard
This virtual sensor exports the data it receives to the database of your
 choice.
 This can be interesting when debugging your GSN configuration or to easily
 back up critical data on an independent machine.
 It can also be used to log unexpected events for later off-line, manual
 analysis.
 It can receive any number of input streams.
 Each one will be saved into a separate table named after the input stream.
\end_layout

\begin_layout Standard
It requires a JDBC URL and a user name and password so that it knows where
 is the database server and how to authenticate.
 This virtual sensor inserts the data into the specified table.
 If the table doesn't exist, GSN first create ths table and if the table
 exists, GSN first verifies the structure of the table with the structure
 of the produced stream elements.
 If the structure matches, GSN starts inserting data into the table otherwise
 it stops with an error message to inform the user about the uncompatible
 strucutres.
\end_layout

\begin_layout Standard
\begin_inset Float table
placement h
wide false
sideways true
status open

\begin_layout Standard
\begin_inset Caption

\begin_layout Standard
Parameters for Stream Exporter
\end_layout

\end_inset


\end_layout

\begin_layout Standard

\hfill

\begin_inset Tabular
<lyxtabular version="3" rows="5" columns="5">
<features>
<column alignment="center" valignment="top" leftline="true" width="0">
<column alignment="center" valignment="top" leftline="true" width="12line%">
<column alignment="center" valignment="top" leftline="true" width="0">
<column alignment="center" valignment="top" leftline="true" rightline="true" width="25line%">
<column alignment="center" valignment="top" rightline="true" width="0">
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Parameter name
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Type
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Mandatory
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Description
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Default
\end_layout

\end_inset
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
url
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
String
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Yes
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
A JDBC url that specifies how to connect to the database server.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
None
\end_layout

\end_inset
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
user
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
String
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Yes
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
The user name for authentication with database server.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
None
\end_layout

\end_inset
</cell>
</row>
<row topline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
password
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
String
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
Yes
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
The password for authentication with database server.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
None
\end_layout

\end_inset
</cell>
</row>
<row topline="true" bottomline="true">
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard

\family typewriter
table
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
String
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
No
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
The name of the table into which GSN will store the sensor data.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Standard
None
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\hfill

\end_layout

\end_inset


\end_layout

\begin_layout Section
Data publishing
\end_layout

\begin_layout Subsection
\begin_inset LatexCommand index
name "Web"

\end_inset

Web Interface
\end_layout

\begin_layout Standard
GSN ships with an elegant and easy to use web interface.
 The only thing you have to do is to open a web browser and go the following
 address: 
\begin_inset LatexCommand htmlurl
target "http://127.0.0.1:22001"

\end_inset

 .
\end_layout

\begin_layout Subsubsection
\begin_inset LatexCommand index
name "GoogleMaps"

\end_inset

GoogleMaps integration
\end_layout

\begin_layout Standard
GSN can associate your data with GPS positions and then display these on
 a world map retrieved from Google's GoogleMaps service.
 You need a special identification key from Google.
 For more information, please refer to the documentation file 
\family typewriter
doc/README.txt
\family default
, section 
\begin_inset Quotes eld
\end_inset


\emph on
How to use GoogleMaps with GSN
\emph default

\begin_inset Quotes erd
\end_inset

.
\end_layout

\begin_layout Subsection
\begin_inset LatexCommand index
name "Email notifications"

\end_inset

Email notifications
\end_layout

\begin_layout Standard
In order to use email or SMS
\begin_inset LatexCommand index
name "SMS"

\end_inset

 (Short Messaging System, text messages for GSM phones) notifications, you
 need to download two third-parties libraries that we are not allowed to
 distribute.
 
\end_layout

\begin_layout Standard
The first one is the 
\emph on
JavaBeans Activation Framework
\emph default

\begin_inset LatexCommand index
name "JavaBeans Activation Framework"

\end_inset

 (JAF), which you can find at 
\begin_inset LatexCommand url
target "http://java.sun.com/products/javabeans/jaf/index.jsp"

\end_inset

.
 After downloading it, you have to copy the file 
\family typewriter
activation.jar
\family default
 in the 
\family typewriter
lib
\family default
 directory.
\end_layout

\begin_layout Standard
The second one is 
\emph on
JavaMail
\emph default

\begin_inset LatexCommand index
name "JavaMail"

\end_inset

.
 This can be found at 
\begin_inset LatexCommand url
target "http://java.sun.com/products/javamail/downloads/index.html"

\end_inset

.
 All included JAR files should be copied in the same 
\family typewriter
lib
\family default
 directory.
\end_layout

\begin_layout Subsection
\begin_inset LatexCommand index
name "SMS notifications"

\end_inset

SMS notifications
\end_layout

\begin_layout Part
\begin_inset LatexCommand index
name "Developer"

\end_inset

Developer's Guide
\end_layout

\begin_layout Chapter
Writing a Virtual Sensor Processing Class
\begin_inset LatexCommand label
name "cha:Writing-a-VS"

\end_inset


\end_layout

\begin_layout Standard
In GSN, a virtual sensor processing class is a piece of Java code which
 performs the final stage of the processing.
 The inputs and the output structure of the virtual sensor is specified
 in the virtual sensor description file (VSD).
 Once a virtual sensor is loaded, GSN prepares an object pool for the virtual
 sensor.
 This pool used for both improving the performance and enforcing the maximum
 resource consumption in the highly loaded environemnts.
 You can specify the number of instances per virtual sensor using the <life-cycl
e pool-size="X"/> element.
 Every virtual sensor processing class (VSPC) extends the AbstractVirtualSensor
 class.
\end_layout

\begin_layout Section
The AbstractVirtualSensor
\begin_inset LatexCommand index
name "AbstractVirtualSensor"

\end_inset

 class
\end_layout

\begin_layout Standard
All virtual sensors are subclass 
\family typewriter
of the AbstractVirtualSensor
\family default
 (package 
\family typewriter
gsn.vsensor
\family default
).
 It requires its subclasses to implement the following three methods:
\end_layout

\begin_layout Itemize

\family typewriter
public boolean initialize()
\end_layout

\begin_layout Itemize

\family typewriter
public void dataAvailable(String inputStreamName, StreamElement se)
\end_layout

\begin_layout Itemize

\family typewriter
public void finalize()
\end_layout

\begin_layout Standard

\family typewriter
initialize()
\family default
 is the first method to be called after object creation.
 It should configure the virtual sensor according to its parameters, if
 any, and return 
\family typewriter
true
\family default
 in case of success, 
\family typewriter
false
\family default
 if otherwise.
 If this method returns false, GSN will generate an error message in the
 logs and stops using the virtual sensor.
\end_layout

\begin_layout Standard

\family typewriter
finalize()
\family default
 is called when GSN destroys the virtual sensor.
 It should release all system resources in use by this virtual sensor.
 This method is typically called when we want to shutdown the GSN instance.
\end_layout

\begin_layout Standard

\family typewriter
dataAvailable
\family default
 is called each time that GSN has data for this virtual sensor, according
 to its configuration.
 If the virtual sensor produces data, it should encapsulate this data in
 a 
\family typewriter
StreamElement
\family default
 object and deliver it to GSN by calling 
\family typewriter
dataProduced(StreamElement se)
\family default
.
 
\end_layout

\begin_layout Standard
Note that a Virtual Sensor should always use the same StreamElement structure
 for producing its data.
 Changing the structure type is not allowed and trying to do so will result
 in an error.
 However, a virtual sensor can be configured at initialization time what
 kind of StreamElement it will produce.
 This allows to produce different types of StreamElement by the same VS
 depending on its usage.
 But one instance of the VS will still be limited to produce the same structure
 type.
 If a virtual sensor really needs to produce several different stream elements,
 user must provide the set of all possibily fields in the stream elements
 and provide Null whenever the data item is not applicable.
\end_layout

\begin_layout Section
Reading Initialization Parameters
\end_layout

\begin_layout Standard
As you noticed in the Chart virtual sensor, a virtual sensor can receive
 parameters from the virtual sensor description file and use them in the
 initialization process.
 An initialization parameter has a name and a value both are in the form
 of String.
 The parameter name is cases insensitive.
\end_layout

\begin_layout Standard
For example, in order to read the value of the 
\begin_inset Quotes eld
\end_inset

my-parameter
\begin_inset Quotes erd
\end_inset

 parameter form the following code snippets
\end_layout

\begin_layout Standard
...
\end_layout

\begin_layout Standard
<processing-class> 
\end_layout

\begin_layout Standard
<class-name>gsn.vsensor.ChartVirtualSensor</class-name>
\end_layout

\begin_layout Standard
<init-params>
\end_layout

\begin_layout Standard
<param name="my-parameter">123456</param>
\end_layout

\begin_layout Standard
</init-params> 
\end_layout

\begin_layout Standard
...
\end_layout

\begin_layout Standard
You can use the following java code in the initialize method : 
\end_layout

\begin_layout Standard
TreeMap < String , String > params = getVirtualSensorConfiguration( ).getMainClas
sInitialParams( ); 
\end_layout

\begin_layout Standard
String value = params.get("my-parameter");
\end_layout

\begin_layout Standard
if (value ==null){ // parameter is missing.
 
\end_layout

\begin_layout Standard
// use default value or return false with an error message.
\end_layout

\begin_layout Standard
}
\end_layout

\begin_layout Section
The 
\begin_inset LatexCommand index
name "StreamElement"

\end_inset

StreamElement class
\end_layout

\begin_layout Standard
A StreamElement is a GSN class that encapsulates data.
 It has a data types structure (a DataField array), a data values structure
 (a Serializable array) and a timestamp.
\end_layout

\begin_layout Section
Writing your own graphical user interface
\begin_inset LatexCommand index
name "graphical user interface"

\end_inset


\end_layout

\begin_layout Standard
A virtual sensor is not limited to raw data processing.
 You can call any other Java library, including Swing classes.
 An introduction to GUI programming is outside the scope of this document.
 You can have a look at the HCIProtocolGUIVS class to see how such an interface
 can be implemented.
\end_layout

\begin_layout Standard
A simple way to go is to create the graphical components (like a JFrame)
 in the 
\family typewriter
initialize()
\family default
 method and at the same time define the events logic (
\family typewriter
eventListeners
\family default
...).
 In the 
\family typewriter
dataAvailable()
\family default
 method, received data can be sent to graphical components to present the
 information to the user.
 Beware that there may be concurrency problems since your GUI is running
 with the Swing event thread while your virtual sensor is run by a GSN thread.
\end_layout

\begin_layout Section
Feedback channel to a Virtual Sensor
\end_layout

\begin_layout Standard
public boolean dataFromWeb ( String action,String[] paramNames, Serializable[]
 paramValues )
\end_layout

\begin_layout Chapter
Writing a Wrapper
\begin_inset LatexCommand label
name "cha:Writing-a-Wrapper"

\end_inset


\end_layout

\begin_layout Section
A quick how-to
\end_layout

\begin_layout Standard
All wrappers subclass 
\family typewriter
gsn.wrapper.AbstractWrapper.

\family default
 Subclasses must implement four methods:
\end_layout

\begin_layout Enumerate

\family typewriter
boolean initialize()
\end_layout

\begin_layout Enumerate

\family typewriter
void finalize()
\end_layout

\begin_layout Enumerate

\family typewriter
String getWrapperName()
\end_layout

\begin_layout Enumerate

\family typewriter
DataField[] getOutputFormat()
\end_layout

\begin_layout Standard
Each wrapper is a thread in the GSN.
 If you want to do some kind of processing in a fixed time interval, you
 can override the 
\family typewriter
run()
\family default
 method.
 The run method is useful for time driven wrappers in which the production
 of a sensor data is triggered by a timer.
 
\end_layout

\begin_layout Standard
Optionally, you may wish to override the following one:
\end_layout

\begin_layout Itemize

\family typewriter
boolean sendToWrapper(String action, String[] paramNames, Object[] paramValues)
 
\end_layout

\begin_layout Subsection
initialize()
\end_layout

\begin_layout Standard
This method is called after the wrapper object creation.
 For more information on the life cycle of a wrapper, see section 
\begin_inset LatexCommand vref
reference "sub:wrapper-life-cycle"

\end_inset

.
 The complete method prototype is 
\family typewriter
public boolean initialize()
\family default
.
\end_layout

\begin_layout Standard
In this method, the wrapper should try to initialize its connection to the
 actual data producing/receiving device(s) (e.g., wireless sensor networks
 or cameras).
 The wrapper should return 
\family typewriter
true
\family default
 if it can successfully initialize the connection, 
\family typewriter
false
\family default
 otherwise.
\end_layout

\begin_layout Standard
GSN provides access to the wrapper parameters through the
\end_layout

\begin_layout Standard

\family typewriter
getActiveAddressBean().getPredicateValue(
\begin_inset Quotes eld
\end_inset

parameter-name
\begin_inset Quotes erd
\end_inset

)
\family default
 
\end_layout

\begin_layout Standard
method call.
\end_layout

\begin_layout Standard
For example, if you have the following fragment in the virtual sensor configurat
ion file:
\end_layout

\begin_layout LyX-Code
<stream-source ...
 > 
\end_layout

\begin_layout LyX-Code
  <address wrapper="x">
\end_layout

\begin_layout LyX-Code
    <predicate key="range">100</predicate>
\end_layout

\begin_layout LyX-Code
    <predicate key="log">0</predicate>
\end_layout

\begin_layout LyX-Code
  </address> 
\end_layout

\begin_layout Standard
You can access the initialization parameter named 
\emph on
x
\emph default
 with the following code :
\end_layout

\begin_layout LyX-Code
if(getActiveAddressBean().getPredicateValue("x") != null)
\end_layout

\begin_layout LyX-Code
  {...} 
\end_layout

\begin_layout Standard
By default GSN assumes that the timestamps of the data produced in a wrapper
 are local, that is, the wrapper produced them using the system (or GSN)
 time.
 If you have cases where this assumption is not valid and GSN should assume
 remote timestamps for stream elements, add the following line in the 
\family typewriter
initialize()
\family default
 method:
\end_layout

\begin_layout LyX-Code
setUsingRemoteTimestamp(true);
\end_layout

\begin_layout Subsection
finalize()
\end_layout

\begin_layout Standard
In the 
\family typewriter
public void finalize()
\family default
 method, you should release all the resources you acquired during the initializa
tion procedure or during the life cycle of the wrapper.
 Note that this is the last chance for the wrapper to release all its reserved
 resources and after this call the wrapper instance virtually won't exist
 anymore.
 
\end_layout

\begin_layout Standard
For example, if you open a file in the initialization phase, you should
 close it in the finalization phase.
\end_layout

\begin_layout Subsection
getWrapperName()
\end_layout

\begin_layout Standard

\family typewriter
public String getWrapperName()
\family default
 returns a name for the wrapper.
\end_layout

\begin_layout Subsection
getOutputFormat()
\end_layout

\begin_layout Standard

\family typewriter
public abstract DataField[] getOutputFormat()
\family default
 returns a description of the data structure produced by this wrapper.
\end_layout

\begin_layout Standard
This description is an array of 
\family typewriter
DataField
\family default
 objects.
 A 
\family typewriter
DataField
\family default
 object can be created with a call to the constructor 
\family typewriter
public
\family default
 
\family typewriter
DataField(String name, String type, String Description)
\family default
.
 The name is the field name, the type is one of GSN data types (
\family typewriter
TINYINT, SMALLINT, INTEGER, BIGINT, CHAR(#), BINARY[(#)], VARCHAR(#), DOUBLE,
 TIME
\family default
.
 See 
\family typewriter
gsn.beans.DataTypes
\family default
) and 
\family typewriter
Description
\family default
 is a text describing the field.
\end_layout

\begin_layout Standard
The following examples should help you get started.
\end_layout

\begin_layout Subsubsection
Wireless Sensor Network Example
\end_layout

\begin_layout Standard
Assuming that you have a wrapper for a wireless sensor network which produces
 the average temperature and light value of the nodes in the network, you
 can implement 
\family typewriter
getOutputFormat()
\family default
 like below :
\end_layout

\begin_layout LyX-Code
public DataField[] getOutputFormat() {
\end_layout

\begin_layout LyX-Code
  DataField[] outputFormat = new DataField[2];
\end_layout

\begin_layout LyX-Code
  outputFormat[0] = new DataField("Temperature", "double", 
\end_layout

\begin_layout LyX-Code
      "Average of temperature readings from the sensor network"); 
\end_layout

\begin_layout LyX-Code
  outputFormat[1] = new DataField("light", "double", 
\end_layout

\begin_layout LyX-Code
      "Average of light readings from the sensor network");
\end_layout

\begin_layout LyX-Code
  return outputFormat; 
\end_layout

\begin_layout LyX-Code
}
\end_layout

\begin_layout Subsubsection
Webcam Example
\end_layout

\begin_layout Standard
if you have a wrapper producing jpeg images as output (e.g., from wireless
 camera), the method is similar to below :
\end_layout

\begin_layout LyX-Code
public DataField[] getOutputFormat() {
\end_layout

\begin_layout LyX-Code
  DataField[] outputFormat = new DataField[1];
\end_layout

\begin_layout LyX-Code
  outputFormat[0] = new DataField("Picture", "binary:jpeg",
\end_layout

\begin_layout LyX-Code
      "Picture from the Camera at room BC143"); 
\end_layout

\begin_layout LyX-Code
  return outputFormat; 
\end_layout

\begin_layout LyX-Code
}
\end_layout

\begin_layout Subsection
run()
\end_layout

\begin_layout Standard
Implementation of the 
\family typewriter
run()
\family default
 method: as described before, the wrapper acts as a bridge between the actual
 hardware device(s) and GSN, thus in order for the wrapper to produce data,
 it should keep track of the newly produced data items.
 This method is responsible for forwarding (and possibly filtering or aggregatin
g) the newly received data from the hardware to the GSN engine.
\end_layout

\begin_layout Standard
You should not try to start the thread by yourself: GSN takes care of this.
\end_layout

\begin_layout Standard
The method should be implemented like below :
\end_layout

\begin_layout LyX-Code
try { 
\end_layout

\begin_layout LyX-Code
//The delay needed for the GSN container to initialize itself.
 
\end_layout

\begin_layout LyX-Code
//Removing this line might cause hard to find random exceptions 
\end_layout

\begin_layout LyX-Code
Thread.sleep (2000); 
\end_layout

\begin_layout LyX-Code
} catch (InterruptedException e1) { 
\end_layout

\begin_layout LyX-Code
  e1.printStackTrace(); 
\end_layout

\begin_layout LyX-Code
}
\end_layout

\begin_layout LyX-Code

\end_layout

\begin_layout LyX-Code
while(isActive()) { 
\end_layout

\begin_layout LyX-Code
  if(listeners.isEmpty())
\end_layout

\begin_layout LyX-Code
   continue;
\end_layout

\begin_layout LyX-Code
  if (isLatestReceivedDataProcessed == false) { 
\end_layout

\begin_layout LyX-Code
    //Application dependent processing ...
 
\end_layout

\begin_layout LyX-Code
    StreamElement streamElement = new StreamElement ( ...); 
\end_layout

\begin_layout LyX-Code
    isLatestReceivedDataProcessed = true; 
\end_layout

\begin_layout LyX-Code
    publishData ( streamElement ); 
\end_layout

\begin_layout LyX-Code
  }
\end_layout

\begin_layout LyX-Code
}
\end_layout

\begin_layout Subsubsection
Webcam example
\end_layout

\begin_layout Standard
Assume that we have a wireless camera which runs a HTTP server and provides
 pictures whenever it receives a 
\family typewriter
GET
\family default
 request.
 In this case we are in a data on demand scenario (most of the network cameras
 are like this).
 To get the data at the rate of 1 picture every 5 seconds we can do the
 following :
\end_layout

\begin_layout LyX-Code
while(isActive()) { 
\end_layout

\begin_layout LyX-Code
  byte[] received_image = null;
\end_layout

\begin_layout LyX-Code
  if(listeners.isEmpty())
\end_layout

\begin_layout LyX-Code
    continue;
\end_layout

\begin_layout LyX-Code
  received_image= getPictureFromCamera();
\end_layout

\begin_layout LyX-Code
  StreamElement streamElement = new StreamElement(
\end_layout

\begin_layout LyX-Code
     new String[] { "PIC" }, 
\end_layout

\begin_layout LyX-Code
     new Integer [] { Types.BINARY },
\end_layout

\begin_layout LyX-Code
     new Serializable[] {received_image}, 
\end_layout

\begin_layout LyX-Code
     System.currentTimeMillis ())
\end_layout

\begin_layout LyX-Code
  );
\end_layout

\begin_layout LyX-Code
  publishData(streamElement);
\end_layout

\begin_layout LyX-Code
  Thread.sleep(5*1000); // Sleeping 5 seconds 
\end_layout

\begin_layout LyX-Code
}
\end_layout

\begin_layout Subsubsection
Data driven systems 
\end_layout

\begin_layout Standard
Compared to the previous example, we do sometimes deal with devices that
 are data driven.
 This means that we don't have control neither on when the data produced
 by them (e.g., when they do the capturing) nor what is the rate of the data
 received from them.
\end_layout

\begin_layout Standard
For example, having an alarm system, we don't know when nor when we are
 going to receive a packet, neither how frequent the alarm system will send
 data packets to GSN.
 These kind of systems are typically implemented using a callback interface.
 In the callback interface, one needs to set a flag indicating the data
 reception state of the wrapper and control that flag in the 
\family typewriter
run
\family default
 method to process the received data.
 
\end_layout

\begin_layout Subsection
sendToWrapper()
\end_layout

\begin_layout Standard
Most devices, in addition to producing data, can also be controlled.
 You can override the method
\end_layout

\begin_layout Standard

\family typewriter
public boolean sendToWrapper(String action, String[] paramNames, Object[]
 paramValues) throws OperationNotSupportedException
\family default
 
\end_layout

\begin_layout Standard
if you want to offer this possibility to the users of your wrapper.
\end_layout

\begin_layout Standard
You can consult the 
\family typewriter
gsn.wrappers.general.SerialWrapper
\family default
 class for an example.
\end_layout

\begin_layout Section
A detailed description of the AbstractWrapper class
\end_layout

\begin_layout Standard
In GSN, a wrapper is piece of Java code which acts as a bridge between the
 actual data producing/receiving device (e.g., sensor network, RFID reader,
 webcam...) and the GSN platform.
 A GSN wrapper should extend the 
\family typewriter
gsn.\SpecialChar \textcompwordmark{}
wrapper.\SpecialChar \textcompwordmark{}
AbstractWrapper
\family default
 class.
 This class provides the following methods and data fields:
\end_layout

\begin_layout LyX-Code
public static final String TIME_FIELD = "TIMED";
\end_layout

\begin_layout LyX-Code
public AddressBean getActiveAddressBean();
\end_layout

\begin_layout LyX-Code
public int getListenersSize(); 
\end_layout

\begin_layout LyX-Code
public ArrayList<DataListener> getListeners(); 
\end_layout

\begin_layout LyX-Code
public CharSequence addListener(DataListener dataListener);
\end_layout

\begin_layout LyX-Code
public void removeListener(DataListener dataListener);
\end_layout

\begin_layout LyX-Code
public int getDBAlias();
\end_layout

\begin_layout LyX-Code
public boolean sendToWrapper(String action, 
\end_layout

\begin_layout LyX-Code
  String[] paramNames, Object[] paramValues) 
\end_layout

\begin_layout LyX-Code
    throws OperationNotSupportedException;
\end_layout

\begin_layout LyX-Code
// Abstract methods
\end_layout

\begin_layout LyX-Code
public abstract boolean initialize();
\end_layout

\begin_layout LyX-Code
pulic abstract void finalize();
\end_layout

\begin_layout LyX-Code
public abstract String getWrapperName();
\end_layout

\begin_layout LyX-Code
public abstract DataField[] getOutputFormat();
\end_layout

\begin_layout Standard
In GSN, the wrappers can not only receive data from a source, but also send
 data to it.
 Thus wrappers are actually two-way bridges between GSN and the data source.
 In the wrapper interface, the method sendToWrapper is called whenever there
 is a data item which should be send to the source.
 A data item could be as simple as a command for turning on a sensor inside
 the sensor network, or it could be as complex as a complete routing table
 which should be used for routing the packets in the sensor network.
 The full syntax of the sendToWrapper is depicted below.
\end_layout

\begin_layout LyX-Code
public boolean sendToWrapper(String action, 
\end_layout

\begin_layout LyX-Code
    String[] paramNames, Object[] paramValues) 
\end_layout

\begin_layout LyX-Code
    throws OperationNotSupportedException;
\end_layout

\begin_layout Standard
The default implementation of the afore-mentioned method throws 
\family typewriter
Operation\SpecialChar \textcompwordmark{}
Not\SpecialChar \textcompwordmark{}
Supported\SpecialChar \textcompwordmark{}
Exception
\family default
 exception because the wrapper doesn't support this operation.
 This design choice is justified by the observation that not all kind of
 devices (sensors) can accept data from a computer.
 For instance, a typical wireless camera doesn't accept commands from the
 wrapper.
 If the sensing device supports this operation, one needs to override this
 method so that instead of the default action (throwing exception), the
 wrapper sends the data to the sensor network.
\end_layout

\begin_layout Section
The life cycle of a wrapper
\begin_inset LatexCommand label
name "sub:wrapper-life-cycle"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Standard
\begin_inset Caption

\begin_layout Standard
The life cycle of a wrapper.
\begin_inset LatexCommand label
name "fig:wrapper-lifecycle"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard

\hfill

\begin_inset Graphics
	filename figures/wrapper-lifecycle.png
	lyxscale 30
	width 100page%
	scaleBeforeRotation
	rotateAngle 90

\end_inset


\hfill

\end_layout

\end_inset


\end_layout

\begin_layout Standard
An instance of a wrapper is created whenever a 
\emph on
Wrapper Connection Request
\emph default
 (WCR) is received by the 
\emph on
Wrappers Repository
\emph default
 (WR).
 The WCRs are generated whenever GSN wants to activate a new virtual sensor.
 A WCR is generated for each stream source in the virtual sensor.
\end_layout

\begin_layout Standard
A Wrapper Connection Request is an object which contains a wrapper name
 and its initialization parameters as defined in the Virtual Sensor Configuratio
n file (VSC).
 Therefore, two WCRs are identicals if their wrapper name and initialization
 parameters are the same.
 The Wrappers Repository in a GSN instance is a repository of the active
 wrapper instances indexed by their WCRs.
 
\end_layout

\begin_layout Standard
Whenever a WCR is generated at the virtual sensor loader, it will be sent
 to the WR which does the following steps (as illustrated on Figure 
\begin_inset LatexCommand vref
reference "fig:wrapper-lifecycle"

\end_inset

): 
\end_layout

\begin_layout Enumerate
Look for a wrapper instance in the repository which has the identical WCR.
 If found, WR registers the stream-source query with the wrapper and returns
 
\family typewriter
true
\family default
.
\end_layout

\begin_layout Enumerate
If there is no such WCR in the repository, the WR instantiates the appropriate
 wrapper object and calls its 
\family typewriter
initialize
\family default
 method.
 If the 
\family typewriter
initialize
\family default
 method returns 
\family typewriter
true
\family default
, WR will add the wrapper instance to the WR.
 Back to Step 1.
\end_layout

\begin_layout Enumerate
If there is no WCR in the repository and the WR can not initialize the new
 wrapper using the specified initialization parameters and GSN context (e.g.,
 the 
\family typewriter
initialize
\family default
 method returns 
\family typewriter
false
\family default
), WR returns 
\family typewriter
false
\family default
 to the virtual sensor loader.
 When the virtual sensor loader receives 
\family typewriter
false
\family default
, it tries the next wrapper (if there is any) .
 The virtual sensor loader fails to load a virtual sensor if at least one
 of the stream sources required by an input stream fails.
\end_layout

\begin_layout Standard
The two main reasons behind using the wrappers repository are: 
\end_layout

\begin_layout Itemize
Sharing the processing power by performing query merging.
\end_layout

\begin_layout Itemize
Reducing the storage when several stream sources use the same wrappers.
\end_layout

\begin_layout Standard
The Wrapper Disconnect Request (WDR) is generated at the 
\family typewriter
virtual-\SpecialChar \textcompwordmark{}
sensor-\SpecialChar \textcompwordmark{}
loader
\family default
 whenever GSN wants to release resources used by a virtual sensor.
 Typically, when the user removes a virtual sensor configuration while GSN
 is running, the virtual-sensor-loader generates a WDR for each stream source
 that was previously used by this virtual sensor.
 
\end_layout

\begin_layout Standard
When WR receives a WDR request, it de-registers the stream-source query
 from the wrapper.
 If after removing the stream source query from the wrapper, there are no
 queries registered with this wrapper (e.g., no other stream source is using
 the considered wrapper), WR calls the 
\family typewriter
finalize
\family default
 method of the wrapper instance so that all its allocated resources will
 be released.
\end_layout

\begin_layout Section
Questions and Answers
\end_layout

\begin_layout Subsection
When is the sendToWrapper method called ? 
\end_layout

\begin_layout Standard
The sendToWrapper method can be only called from a virtual sensor which
 uses this wrapper.
 The code in the virtual sensor's class will be something like below:
\end_layout

\begin_layout LyX-Code
virtualSensorConfiguration.getInputStream(INPUT_STREAM_NAME).
\end_layout

\begin_layout LyX-Code
  getSource(STREAM_SOURCE_ALIAS_NAME).
\end_layout

\begin_layout LyX-Code
  getActiveSourceProducer().
\end_layout

\begin_layout LyX-Code
  sendToWrapper(mydata);
\end_layout

\begin_layout Standard
So a virtual sensor can send data to the wrapper and the wrapper will forward
 it (if the 
\family typewriter
sendToWrapper
\family default
 method is implemented) to the actual data source.
\end_layout

\begin_layout Subsection
How does a virtual sensor decide when to send data to the wrapper ? 
\end_layout

\begin_layout Standard
A virtual sensor will typically decide using the following factors : 
\end_layout

\begin_layout Enumerate
Based on its internal state, which depends on received data.
\end_layout

\begin_layout Enumerate
After an interaction initiated by a user/agent/gsn-instance with the web
 interface; HTTP (e.g., implementing the 
\family typewriter
dataFromWeb
\family default
 method in the virtual sensor, or when another virtual sensor sends data
 to this sensor server).
\end_layout

\begin_layout Chapter
The Web Interface
\end_layout

\begin_layout Standard
This is a presentation of the web interface bundled with GSN.
 It can be used as a starting point for creating another one.
\end_layout

\begin_layout Standard
In GSN we separated the look and feel of the web interface from the underlying
 processing components.
 This design enables other users to provide their own web interface over
 the GSN.
 In this section we describe both the current server side protocol and the
 currently available web interface which visualizes the data from the server.
 While the server side component is fixed with GSN, the client side web
 interface can be changed based on the users and applications.
\end_layout

\begin_layout Section
ServerSide protocol
\end_layout

\begin_layout Standard
In GSN, all the request are first received by the the /gsn (gsn.web.ControllerServ
let).
 In GSN we provide several request handlers each of them implements the
 gsn.web.RequestHandler interface.
 Each request from the clients has a REQUEST parameter to specify the request
 type, 
\family typewriter
http://server/gsn?REQUEST=
\family default
\shape italic
type
\shape default
, where 
\shape italic
type
\shape default
 is an integer.
 If there is no 
\shape italic
type
\shape default
 specified, ControllerServlet assumes type 0.
 Here are the list of the parameters and the Contant representing them.
\end_layout

\begin_layout Itemize
0, or not present: REQUEST_LIST_VIRTUAL_SENSORS.
 
\end_layout

\begin_layout Itemize
113, REQUEST_OUTPUT_FORMAT.
\end_layout

\begin_layout Itemize
114, REQUEST_ONE_SHOT_QUERY.
\end_layout

\begin_layout Itemize
115, REQUEST_ADDRESSING.
\end_layout

\begin_layout Itemize
116, REQUEST_ONE_SHOT_QUERY_WITH_ADDRESSING.
\end_layout

\begin_layout Standard
The RequestHandler interface two methods:
\end_layout

\begin_layout Itemize
isValid (HttpServletRequest, HttpServletResponse) verifying the validity
 of the request (presence and validity of the parameters) or responding
 by and error message if not.
 
\end_layout

\begin_layout Itemize
handle (HttpServletRequest, HttpServletResponse) which treat the request
 and send the response in XML format 
\end_layout

\begin_layout Subsection
REQUEST_LIST_VIRTUAL_SENSORS (Default, Zero)
\end_layout

\begin_layout Standard
Has the following informations: 
\end_layout

\begin_layout Itemize
GSN information from the 
\family typewriter
gsn.xml
\family default
 file (name, author, email, description) .
\end_layout

\begin_layout Itemize
For each valid virtual sensor
\end_layout

\begin_deeper
\begin_layout Itemize
Virtual Sensor name, description and the timestamp of the most recently
 produced stream element.
 
\end_layout

\begin_layout Itemize
The list of the addressing predicates (category=
\begin_inset Quotes erd
\end_inset

predicate
\begin_inset Quotes erd
\end_inset

)
\end_layout

\begin_layout Itemize
The list of the output fields,their types and their most recent value.
 The value of the field is only included in the output if it can be easily
 converted to String format.
 If the type of a field is binary (e.g., a JPEG image), as the value, the
 controller returns a URL pointing to the /field(gsn.web.FieldDownloadServlet)
 to retrive the actual binary data.
\end_layout

\end_deeper
\begin_layout Standard

\end_layout

\begin_layout Standard
Example: 
\end_layout

\begin_layout Standard

\family typewriter
<gsn name="Container" author="EPFL" email="ali.salehi@epfl.ch" description="Not
 Provided">
\end_layout

\begin_layout Standard

\family typewriter
<virtual-sensor name="invmaccess" last-modified="1173280806000" description="MyV
S">
\end_layout

\begin_layout Standard

\family typewriter
<field name="image" type="binary:image/jpeg">/field?vs=invmaccess&field=DATA&pk=
2868</field>
\end_layout

\begin_layout Standard

\family typewriter
<field name="timed" type="long" description="The timestamp associated with
 the stream element">1174999988339</field>
\end_layout

\begin_layout Standard

\family typewriter
<field name="geographical" category="predicate">BC 143, EPFL, Lausanne </field>
\end_layout

\begin_layout Standard

\family typewriter
</virtual-sensor>
\end_layout

\begin_layout Standard
</gsn>
\end_layout

\begin_layout Subsection
REQUEST_OUTPUT_FORMAT (113)
\end_layout

\begin_layout Standard
Provides the output structure of a given virtual sensors.
 The only parameter needed is name of the virtual sensor the user want the
 description of (e.g., 
\family typewriter
http://server/get?REQUEST=113
\backslash
&name=
\family default
\shape italic
VirtualSensorName
\end_layout

\begin_layout Subsection
REQUEST_ONE_SHOT_QUERY (114)
\end_layout

\begin_layout Standard
This request is handled by the class gsn.vsensor.http.OneShotQueryHandler.
 This servlet executes a one shot query over the GSN's internal table and
 presents the results in the form of the stream elements.
 This request needs the following parameters:
\end_layout

\begin_layout Itemize
name, the name of the virtual sensor [mandatory]
\end_layout

\begin_layout Itemize
condition: the WHERE part of the request (ex: LATITUDE > 100 AND light <
 10) [optional]
\end_layout

\begin_layout Itemize
fields: an array of the requested fields in the stream elements.
 If not present, * is used [optional]
\end_layout

\begin_layout Itemize
window: the number last elements wanted (1 if not present) [optional] 
\end_layout

\begin_layout Standard
Example, accessing the 
\family typewriter
http://localhost:22001/gsn?REQUEST=114&name=invmaccess
\end_layout

\begin_layout Standard

\family typewriter
<result> 
\end_layout

\begin_layout Standard

\family typewriter
<stream-element> 
\end_layout

\begin_layout Standard

\family typewriter
<field name="DATA">/field?vs=invmaccess&field=DATA&pk=5130</field>
\end_layout

\begin_layout Standard

\family typewriter
<field name="timed">1175001199874</field> </stream-element> 
\end_layout

\begin_layout Standard

\family typewriter
</result>
\end_layout

\begin_layout Subsection
REQUEST_ADDRESSING (115)
\end_layout

\begin_layout Standard
Given the name of the virtual sensor, it provides the addressing predicates
 associated with the virtual sensor.
 It is very similar to 
\family typewriter
REQUEST_OUTPUT_FORMAT.
\end_layout

\begin_layout Standard
Example, accessing the 
\family typewriter
http://localhost:22001/gsn?REQUEST=115&name=invmaccess
\end_layout

\begin_layout Standard

\family typewriter
<virtual-sensor name="invmaccess" last-modified="1173280806000">
\end_layout

\begin_layout Standard

\family typewriter
<predicate key="geographical">BC 143, EPFL, Lausanne</predicate> </virtual-senso
r>
\end_layout

\begin_layout Subsection
REQUEST_ONE_SHOT_QUERY_WITH_ADDRESSING (116)
\end_layout

\begin_layout Standard
This request is actually the combination of the REQUEST_ONE_SHOT_QUERY and
 REQUEST_ADDRESSING in one request.
 The parameters
\end_layout

\begin_layout Standard
are the union of the specified types.
 Example: 
\family typewriter
http://localhost:22001/gsn?REQUEST=116&name=invmaccess
\end_layout

\begin_layout Standard

\family typewriter
<result>
\end_layout

\begin_layout Standard

\family typewriter
<stream-element>
\end_layout

\begin_layout Standard

\family typewriter
<field name="DATA">/field?vs=invmaccess&field=DATA&pk=15102</field>
\end_layout

\begin_layout Standard

\family typewriter
<field name="timed">1175006917711</field>
\end_layout

\begin_layout Standard

\family typewriter
<field name="geographical">BC 143, EPFL, Lausanne</field>
\end_layout

\begin_layout Standard

\family typewriter
</stream-element>
\end_layout

\begin_layout Standard

\family typewriter
</result>
\end_layout

\begin_layout Standard
You might ask why we need this request if we can get the same result by
 combining the 115 and 114 ? The answer is the performance, establishing
 the TCP connections are expensive.
\end_layout

\begin_layout Section
Client Side JavaScript
\end_layout

\begin_layout Subsection
Javascript files
\end_layout

\begin_layout Standard
For rapid development, the GSN web interface uses many pieces of existing
 javascript code which are in the js folder.
\end_layout

\begin_layout Standard
The following files are part of the webapp:
\end_layout

\begin_layout Itemize
jquery-latest.pack.js: The main jQuery library.
 The version in use comes from the svn as some needed fixes were not available
 in the latest version.
 
\end_layout

\begin_layout Itemize
jquery-dom.js: An extension to jQuery which allows easy DOM creation written
 like $.DIV(
\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

"class":"test"
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

,"content"); 
\end_layout

\begin_layout Itemize
jquery.history.js: An extension to jQuery to manage the hash part of the location
 url (index.html#hash).
 It is used to allow the page to be fully static html while at the same
 time still support the browser back button and bookmarking of a specific
 part of the page.
 
\end_layout

\begin_layout Itemize
dimensions.js: An extension to jQuery to know the page's width and height.
 Used only in fullmap.html in order to have the container with vsboxes of
 the right size.
 
\end_layout

\begin_layout Itemize
datepicker.js: Customized extension of jquery used for the datetime helper.
\end_layout

\begin_layout Itemize
jquery-tooltip.js: A plugin to have better tooltips than the browser default
 behaviour which is used for descriptions.
 
\end_layout

\begin_layout Itemize
gsn.js: Our core javascript code.
 Explanations in the next subsection.
 
\end_layout

\begin_layout Subsection
gsn.js core function
\end_layout

\begin_layout Standard
Almost all of gsn JavaScript code is regrouped inside gsn.js.
 It is written using a JavaScript Object Notation and use a GSN object to
 reduce the risk of conflicts with any future addition of JavaScript code.
 
\emph on
vsName
\emph default
, the name of the virtual sensor (text) is considered as unique, which explains
 why it is so much used as a parameter.
 Most of the ajax calls go to the 
\emph on
/gsn
\emph default
 servlet.
 The data part uses the 
\emph on
/data
\emph default
 servlet for retrieving data.
 Binary and image are accessed through the 
\emph on
/field
\emph default
 servlet and webinput upload goes to the 
\emph on
/upload
\emph default
 servlet.
\end_layout

\begin_layout Standard
Here is a brief explanation of the core variables and functions:
\end_layout

\begin_layout Itemize
GSN.context: defines which page of gsn is being displayed (home, data, map
 or fullmap).
 
\end_layout

\begin_layout Itemize
GSN.load(): initializes a page load (begin, tab click & back button).
 
\end_layout

\begin_layout Itemize
GSN.msgcallback(): callback method when the webupload iframe finishes.
 
\end_layout

\begin_layout Itemize
GSN.nav(page): click on the top navigation bar.
 
\end_layout

\begin_layout Itemize
GSN.menu(vsName): click on the virtual sensor on the left bar.
 
\end_layout

\begin_layout Itemize
GSN.loaded: is true after the first load of XML info which calls GSN.init().
 
\end_layout

\begin_layout Itemize
GSN.init(): initializes the gsn title and the left side menu.
 
\end_layout

\begin_layout Itemize
GSN.updatenb: a counter to prevent multiple instances of GSN.updateall().
 
\end_layout

\begin_layout Itemize
GSN.updateall(): Ajax call to update all the sensor displays on the page
 and the map.
 
\end_layout

\begin_layout Itemize
GSN.addandupdate(vsName): adds a vsbox if it doesn't exist, bring it to front
 and update it.
 
\end_layout

\begin_layout Standard
The virtual sensor information (dynamic, static and structure) are regrouped
 in a div box called the vsbox.
 This div has the class .vsbox and .vsbox-
\begin_inset ERT
status collapsed

\begin_layout Standard

{
\end_layout

\end_inset

the virtual sensor name
\begin_inset ERT
status collapsed

\begin_layout Standard

}
\end_layout

\end_inset

.
 They will be put in the container specified by GSN.vsbox.container.
 Here are the function of the GSN.vsbox.* part:
\end_layout

\begin_layout Itemize
GSN.vsbox.container: the container to put the vsbox (default "#vs").
 
\end_layout

\begin_layout Itemize
GSN.vsbox.add(vsName): creates an empty vsbox.
 
\end_layout

\begin_layout Itemize
GSN.vsbox.bringToFront(vsName): brings a vsbox at the beginning of the container.
 
\end_layout

\begin_layout Itemize
GSN.vsbox.update(vs): updates and shows all the data of the vsbox.
 
\end_layout

\begin_layout Itemize
GSN.vsbox.remove(vsName): removes the vsbox from the container.
 
\end_layout

\begin_layout Itemize
GSN.vsbox.toggle(...): to manage the click on tab.
 
\end_layout

\begin_layout Standard
All the functionality used to display the virtual sensor on the google map
 is regrouped in the GSN.map.* part.
 Here is the core functionality:
\end_layout

\begin_layout Itemize
GSN.map.loaded: ss true after the initialisation of the google map.
 
\end_layout

\begin_layout Itemize
GSN.map.markers : array containing the displayed markers.
 
\end_layout

\begin_layout Itemize
GSN.map.highlighted : the index of the focused marker or null.
 
\end_layout

\begin_layout Itemize
GSN.map.highlightedmarker : the green marker.
 
\end_layout

\begin_layout Itemize
GSN.map.init(): initializes the google map.
 
\end_layout

\begin_layout Itemize
GSN.map.userchange(): callback after any map change (zoom and map move) and
 vs toggle to update #hash of URL.
 
\end_layout

\begin_layout Itemize
GSN.map.zoomend(..): callback after any zoom change, used for the tricked followed
 marker.
 
\end_layout

\begin_layout Itemize
GSN.map.trickhighlighted(): followed marker and top of the others.
 
\end_layout

\begin_layout Itemize
GSN.map.autozoomandcenter(): auto-zoom and center on the visible sensors.
 
\end_layout

\begin_layout Itemize
GSN.map.addMarker(vsName,lat,lon): adds a vs marker on the map.
\end_layout

\begin_layout Itemize
GSN.map.markerIsVisible(vsName): returns if a marker is visible.
\end_layout

\begin_layout Itemize
GSN.map.toggleAllMarkers(): toggles all markers (visible or not).
\end_layout

\begin_layout Itemize
GSN.map.toggleMarker(vsName): toggles marker (visible or not).
 
\end_layout

\begin_layout Itemize
GSN.map.updateMarker(vsName,lat,lon): updates a vs marker position on the
 map.
 
\end_layout

\begin_layout Itemize
GSN.map.followMarker(vsName): highlights a marker, stops it if called with
 null name.
 
\end_layout

\begin_layout Itemize
GSN.map.showAllMarkers(): zoom out to see all markers.
 
\end_layout

\begin_layout Standard
The functionality in the data webpage is regrouped in the GSN.data.* part
 and was only bugfixed and slightly improved.
 The remaining GSN.util.* functions are basic formatting piece of code that
 don't need any explanations at all.
\end_layout

\begin_layout Subsection
Problems faced
\end_layout

\begin_layout Subsubsection
Dropping tables
\end_layout

\begin_layout Standard
The first version of the gsn webapp "template" was using tables for layout
 which is considered as bad by most web designers.
 Therefore, it was transformed to a layout using only divs elements and
 css attributes for styling.
 The advantages are: cleaner html code, easier to understand, more flexible
 (as changing only the css could change the whole look & feel) and faster
 as the size is smaller and the css file can be cached by the client browser.
 It was quickly rewritten from scratch to match the current gsn website
 style.
\end_layout

\begin_layout Subsubsection
IE showstopper
\end_layout

\begin_layout Standard
A big problem was identified after the first week of implementation.
 Some of the functionality used in jQuery library was not compatible with
 IE.
 Some rare XML parsing modes totally broke.
 Hopefully, with the help of the jQuery team, it was resolved.
 Therefore, a switch was made from jQuery 1.0 to the jQuery from the svn
 as it was the only fixed version.
\end_layout

\begin_layout Standard
Another IE only bug caused problems, because Ajax request in IE are locally
 cached like any normal http request.
 Therefore, the webapp wasn't refreshing even if the Javascript was working
 fine and making ajax calls.
 It was easily resolved by adding to the XML API servlet various http headers
 (Expires, Cache-Control,..) to avoid any caching at all.
\end_layout

\begin_layout Subsubsection
Retrieving dynamic data with ajax
\end_layout

\begin_layout Standard
As the webapp is composed only of static html files, the dynamic data has
 to be pulled from the servlet through JavaScript.
 It is done easily using the 
\emph on
.ajax
\emph default
 function of jQuery.
 In the main 
\emph on
GSN.updateall
\emph default
 function which updates all virtual sensors data at every refresh, the webapp
 calls the servlet at 
\begin_inset LatexCommand url
target "http://localhost:22001/gsn"

\end_inset

 using the following code:
\end_layout

\begin_layout LyX-Code
$.ajax({ type: "GET", url: "/gsn", success: function(data) {
\end_layout

\begin_layout LyX-Code
        // use the data variable which contain virtual sensors data 
\end_layout

\begin_layout LyX-Code
}
\end_layout

\begin_layout Standard
As shown above, using ajax in jQuery is very straightforward.
 The retrieved data is in xml and formatted as below:
\end_layout

\begin_layout LyX-Code

\end_layout

\begin_layout LyX-Code
<gsn name="gsn" author="cb" email="cb@epfl.ch" description="none">
\end_layout

\begin_layout LyX-Code
  <virtual-sensor name="vs" last-modified="1171105166765">
\end_layout

\begin_layout LyX-Code
    <field name="temp" type="long" description="none">-5</field>
\end_layout

\begin_layout LyX-Code
  </virtual-sensor>
\end_layout

\begin_layout LyX-Code
</gsn>
\end_layout

\begin_layout Standard
After retrieving the xml data, it is parsed with the 
\emph on
$()
\emph default
 function of jQuery which supports xml data similarly to inline html.
 The syntax looks as below with the data variable being the ajax reply from
 the servlet:
\end_layout

\begin_layout LyX-Code
$("virtual-sensor",data).each(function(){
\end_layout

\begin_layout LyX-Code
  var vsname = $(this).attr("name");
\end_layout

\begin_layout LyX-Code
});
\end_layout

\begin_layout Standard
When the 
\emph on
GSN.updateall
\emph default
 function finishes to parse xml and updates the inline html with the new
 virtual sensors data, the standard Javascript function 
\emph on
setTimeout()
\emph default
 is used in order to call the 
\emph on
GSN.updateall
\emph default
 function again for the next refresh.
\end_layout

\begin_layout Standard
In addition, when clicking on the right side menu on a virtual sensor, an
 ajax call is made as well.
 The data of the clicked virtual sensor is retrieved using 
\begin_inset LatexCommand url
target "http://localhost:22001/gsn?name=vsname"

\end_inset

.
 The logic is the same than during a 
\emph on
GSN.updateall
\emph default
 but only the specified virtual sensor is in the xml data.
 Using the same JavaScript code, it will update only the specified virtual
 sensor box.
\end_layout

\begin_layout Standard
Not much can go wrong with these ajax calls.
 As specified in its format, the reply will always be fully understood by
 the JavaScript parsing.
 The worst that can happen is that the servlet stops responding.
 In this case, the ajax query will timeouts and never succeeds which will
 stop any further update.
 The ajax indicator (animated gif) will turn forever, showing that something
 went wrong during xml data fetching.
 The client browser should never freeze nor crash.
 The user will actually still be able to use the gsn webapp, but will not
 receive any new updates to the data.
\end_layout

\begin_layout Subsubsection
XML formatting of virtual sensor
\end_layout

\begin_layout Standard
As explained in the design section, the gsn webapp use an xml api to give
 data.
 All the information concerning a virtual sensor is regrouped into a single
 
\emph on
virtual-sensor
\emph default
 block.
 All the different types of data (dynamic, structure, predicate,..) are merged
 into a single entity as it is much more efficient than having to query
 multiple times the servlet.
 The overall size of a single block, as it is only text, costs far less
 than the latency of multiple queries.
 Moreover, the main gsn webapp page requires all types of data at the initializa
tion, thus merging them makes sense.
\end_layout

\begin_layout Standard
Every type of data is mapped into the 
\emph on
field
\emph default
 block following the rules below.
 Field names are converted into lowercase and fields are sorted by type
 in the same order than below.
\end_layout

\begin_layout Standard
To begin with, the 
\emph on
virtual-sensor
\emph default
 block is opened with the following included attributes: 
\end_layout

\begin_layout Itemize
name: virtual sensor name (unique) ;
\end_layout

\begin_layout Itemize
last-modified: last-modified datetime in unix format ;
\end_layout

\begin_layout Itemize
description: virtual sensor description.
\end_layout

\begin_layout Standard
Here is a sample of the xml output from the servlet:
\end_layout

\begin_layout LyX-Code
<gsn name="gsn" author="cb" email="cb@epfl.ch" description="none">
\end_layout

\begin_layout LyX-Code
  <virtual-sensor name="vs" last-modified="1171105166765">
\end_layout

\begin_layout LyX-Code
    <field name="temp" type="long" description="none">-5</field>
\end_layout

\begin_layout LyX-Code
  </virtual-sensor>
\end_layout

\begin_layout LyX-Code
</gsn>
\end_layout

\begin_layout Standard
Then, the dynamic fields with their data are mapped from the output-structure
 block of the xml config of the virtual sensor into a unique field block.
 Below is a xml config sample:
\end_layout

\begin_layout LyX-Code
<gsn name="gsn" author="cb" email="cb@epfl.ch" description="none">
\end_layout

\begin_layout LyX-Code
  <virtual-sensor name="vs" last-modified="1171105166765">
\end_layout

\begin_layout LyX-Code
    <field name="temp" type="long" description="none">-5</field>
\end_layout

\begin_layout LyX-Code
  </virtual-sensor>
\end_layout

\begin_layout LyX-Code
</gsn>
\end_layout

\begin_layout Standard
It would be mapped into the following line in the xml output from the servlet:
\end_layout

\begin_layout LyX-Code
<gsn name="gsn" author="cb" email="cb@epfl.ch" description="none">
\end_layout

\begin_layout LyX-Code
  <virtual-sensor name="vs" last-modified="1171105166765">
\end_layout

\begin_layout LyX-Code
    <field name="temp" type="long" description="none">-5</field>
\end_layout

\begin_layout LyX-Code
  </virtual-sensor>
\end_layout

\begin_layout LyX-Code
</gsn>
\end_layout

\begin_layout Standard
An additional dynamic field is added with the timestamp in unix format as
 in the following xml sample:
\end_layout

\begin_layout LyX-Code
<gsn name="gsn" author="cb" email="cb@epfl.ch" description="none">
\end_layout

\begin_layout LyX-Code
  <virtual-sensor name="vs" last-modified="1171105166765">
\end_layout

\begin_layout LyX-Code
    <field name="temp" type="long" description="none">-5</field>
\end_layout

\begin_layout LyX-Code
  </virtual-sensor>
\end_layout

\begin_layout LyX-Code
</gsn>
\end_layout

\begin_layout Standard
Afterwards, the static predicate fields are mapped from the adressing block
 of the xml config of the virtual sensor into a unique field block as well
 if they exist.
 Below is a predicate xml config sample:
\end_layout

\begin_layout LyX-Code
<gsn name="gsn" author="cb" email="cb@epfl.ch" description="none">
\end_layout

\begin_layout LyX-Code
  <virtual-sensor name="vs" last-modified="1171105166765">
\end_layout

\begin_layout LyX-Code
    <field name="temp" type="long" description="none">-5</field>
\end_layout

\begin_layout LyX-Code
  </virtual-sensor>
\end_layout

\begin_layout LyX-Code
</gsn>
\end_layout

\begin_layout Standard
It would be mapped into the following line in the xml output from the servlet:
\end_layout

\begin_layout LyX-Code
<field name="latitude" category="predicate">37.4</field>
\end_layout

\begin_layout LyX-Code

\end_layout

\begin_layout Standard
Additionally, the webinputs block from the xml config of the virtual sensor
 are mapped into a unique field block if they exist.
 They are not kept hierarchically by command anymore.
 Below is a xml config sample:
\end_layout

\begin_layout LyX-Code
<web-input password="test">
\end_layout

\begin_layout LyX-Code
  <command name="cmd1">
\end_layout

\begin_layout LyX-Code
    <field name="control" type="*binary:2mb">Binary upload</field>
\end_layout

\begin_layout LyX-Code
  </command>
\end_layout

\begin_layout LyX-Code
</web-input>
\end_layout

\begin_layout LyX-Code

\end_layout

\begin_layout Standard
It would be mapped into the following line in the xml output from the servlet:
\end_layout

\begin_layout LyX-Code
<field command="cmd1" name="control" category="input" 
\end_layout

\begin_layout LyX-Code
type="*binary:2mb" description="Binary upload"/>
\end_layout

\begin_layout Standard
Finally, the 
\emph on
virtual-sensor
\emph default
 block is closed.
\end_layout

\begin_layout LyX-Code
</virtual-sensor>
\end_layout

\begin_layout LyX-Code

\end_layout

\begin_layout Standard
Mapping all these different types into the same field block syntax is easier
 to parse by jQuery and allow reuse of code for similar functionality, like
 between dynamic and static fields.
\end_layout

\begin_layout Subsubsection
Highlighted marker on Google map
\end_layout

\begin_layout Standard
The code around GSN.map.trickhighlighted() can look quite suspicious.
 Why so much code and diverse variables just to highlight a marker on Google
 map? Changing from one type of marker to another does not require all this.
 It could have been made easier, but then when you zoom out you might not
 see the highlighted marker if it is surrounded by many other markers.
 It is due because Google map does not allow to specify the z-index of a
 marker and automatically order them by their latitude.
 Thus the marker with the lowest latitude will be shown on top of the others
 one.
\end_layout

\begin_layout Standard
This behaviour can be changed by using a trick which is to use a marker
 with an offsetted latitude and an offsetted marker image which will always
 be at a lower latitude than the other markers.
 Thus always be on top of them.
 It is offsetted depending of the zoom level and the normal marker height.
 With this trick, the highlighted marker is popping out of crowd as shown
 on the left side image.
 
\end_layout

\begin_layout Standard
\align center
\begin_inset Graphics
	filename figures/chapterWebInterface/gsn2_hightrick1.png

\end_inset

 
\begin_inset Graphics
	filename figures/chapterWebInterface/gsn2_hightrick2.png

\end_inset

 
\end_layout

\begin_layout Standard
The only drawback of this technique is that it might look weird sometime
 because of the shape of the marker.
 As the right side image shows, the spike of the highlighted market is on
 top of the one bellow.
 Anyway it isn't that frequent and the benefits when zoomed out in a dense
 area of marker are worth it.
\end_layout

\begin_layout Subsubsection
Bookmarking and back button support for Ajax website
\end_layout

\begin_layout Standard
When a web application uses ajax techniques, one of the key features of
 the browsing experience is broken: the URL.
 With ajax calls made without a page load, the state of the current web
 page is not related to the URL anymore.
 It breaks the back button feature of any browser, and even worse, the current
 web page cannot be bookmarked properly.
 As those feature are essential to a website, it is necessary to find a
 way to mimic them.
 The solution is to use the hash part of the URL : 
\begin_inset LatexCommand url
target "http://server.com/index.html#hash"

\end_inset

.
 The hash part is easily modified through javascript without a page load
 and is considered as a page change by every browser which means that the
 back button feature works.
 In addition, an URL with a hash part can be bookmarked and, with some javascrip
t initialization, can restore the webpage in the same state than when it
 was bookmarked.
 This was implemented using a jQuery extension as some tricky javascript
 code is required to make this functionality compatible with Internet Explorer.
\end_layout

\begin_layout Standard
For example, a URL in the gsn webapp when browsing the map part might look
 like the following:
\newline
 
\begin_inset LatexCommand url
target "http://localhost:22001/#map,lt=38.17343267903539,lo=-121.9537353515625,z=8,vs=gpsvs:gps2:memorymonitorvs"

\end_inset


\end_layout

\begin_layout Standard
Such a URL is fully bookmarkable and will initialize the webapp at the same
 state which allows people to share URL in order to show specific sensors.
 It is decomposed into several parameters which represent: 
\end_layout

\begin_layout Itemize
\begin_inset LatexCommand url
target "map"

\end_inset

: which context/part of the webapp (could be home, data or map) 
\end_layout

\begin_layout Itemize
\begin_inset LatexCommand url
target "lt=38.17343267903539"

\end_inset

: latitude of the map when not in automatic mode 
\end_layout

\begin_layout Itemize
\begin_inset LatexCommand url
target "lo=-121.9537353515625"

\end_inset

: longitude of the map when not in automatic mode 
\end_layout

\begin_layout Itemize
\begin_inset LatexCommand url
target "z=8"

\end_inset

: zoom level of the map when not in automatic mode 
\end_layout

\begin_layout Itemize
\begin_inset LatexCommand url
target "vs=gpsvs:gps2:memorymonitorvs"

\end_inset

: shown virtual sensors when some are hidden 
\end_layout

\begin_layout Standard
Nevertheless, the URL can become quite long with all these parameters inside
 it.
 However, it is not a problem as Internet Explorer supports URL lengths
 up to 2048 characters.
 The alternative web browsers (FireFox, Opera & Safari) are even better
 and support up to 100000 characters.
\end_layout

\begin_layout Subsubsection
Improved UI
\end_layout

\begin_layout Standard
A lot of work went into the design of the general user interface.
 The UI of the data part was highly customized.
 To simplify and to be more error prone, the datetime field was given a
 special helper shown bellow.
\end_layout

\begin_layout Standard
\align center
\begin_inset Graphics
	filename figures/chapterWebInterface/gsn2_datetime.png
	width 60text%

\end_inset

 
\end_layout

\begin_layout Standard
It allows the user to specify a date and time only with mouse click.
 It was proven to be much more quicker that way.
\end_layout

\begin_layout Standard
A waiting indicator was added during ajax calls when gsn refreshes sensors
 fields or when data is retrieved in the data part.
 Such indicators are necessary in ajax applications, otherwise the user
 believes that nothing is happening, gets frustrated and might click multiple
 times, which won't improve respond time.
\end_layout

\begin_layout Subsubsection
Webinput upload to virtual sensor
\end_layout

\begin_layout Standard
The ability to upload input to a virtual sensor, as shown below, was one
 of the last additions to the gsn webapp.
\end_layout

\begin_layout Standard
\align center
\begin_inset Graphics
	filename figures/chapterWebInterface/gsn2_upload.png
	width 60text%

\end_inset

 
\end_layout

\begin_layout Standard
For simplicity and modularity, the upload inputs are regrouped into subgroups
 which can be selected with the upper select box.
 Upload inputs are optional and specified in the sensor xml configuration,
 thus the tab only appears when it is specified.
 The different types are specified but are not enforced on the client side
 as this could be easily bypassed.
 The validation is done on the server side as client input should never
 be trusted.
 The following types have special input fields :
\end_layout

\begin_layout Itemize

\emph on
binary
\emph default
: file upload ;
\end_layout

\begin_layout Itemize

\emph on
radio
\emph default
: radio button with limited choice ;
\end_layout

\begin_layout Itemize

\emph on
checkbox
\emph default
: checkbox with limited choice ;
\end_layout

\begin_layout Itemize

\emph on
select
\emph default
: drop down box with limited choice ;
\end_layout

\begin_layout Standard
The radio, checkbox and select types use the syntax like "radio:ele1|ele2"
 to specify the multiple choice.
 The binary field is limited by a maximum size specified in the type part
 with a syntax like "binary:Xmb".
 When the type begins with a star, it is compulsary.
 Here is a sample xml config which shows all the capabilities:
\end_layout

\begin_layout LyX-Code
<gsn name="gsn" author="cb" email="cb@epfl.ch" description="none">
\end_layout

\begin_layout LyX-Code
  <virtual-sensor name="vs" last-modified="1171105166765">
\end_layout

\begin_layout LyX-Code
    <field name="temp" type="long" description="none">-5</field>
\end_layout

\begin_layout LyX-Code
  </virtual-sensor>
\end_layout

\begin_layout LyX-Code
</gsn>
\end_layout

\begin_layout Standard
An ajax like behaviour was required to give feedback to the user after the
 webinput upload.
 However, the XMLHTTPrequest object used to send ajax calls doesn't support
 file upload for security reasons.
 To bypass this limitation, a normal FORM element is used but uses a hidden
 inline frame as a target.
 When the user clicks the submit button, the upload starts in the hidden
 IFrame to the destination 
\emph on
/upload
\emph default
.
 When the upload ends or breaks, the servlet replies back with html code
 like the following code line.
 This javascript code calls back the parent window GSN core object which
 allows the webapp to give feedback to the user.
\end_layout

\begin_layout LyX-Code
<script>window.parent.GSN.msgcallback('msg',code);</script>
\end_layout

\begin_layout Standard
On the servlet side, the jakarta fileupload library was used to speed up
 development.
 A servlet translates the POST upload into XML-RPC format before sending
 it to the gsn system.
 The xml produced is similar to the following block lines.
 Normal fields are given in text format and binary fields are encoded in
 Base 64.
\end_layout

\begin_layout LyX-Code
<input>
\end_layout

\begin_layout LyX-Code
  <vsname>gpsvs</vsname>
\end_layout

\begin_layout LyX-Code
  <command>test</command>
\end_layout

\begin_layout LyX-Code
  <fields>
\end_layout

\begin_layout LyX-Code
    <field>
\end_layout

\begin_layout LyX-Code
      <name>reset1</name>
\end_layout

\begin_layout LyX-Code
      <value>test comment</value>
\end_layout

\begin_layout LyX-Code
    </field>
\end_layout

\begin_layout LyX-Code
    <field>
\end_layout

\begin_layout LyX-Code
      <name>reset2</name>
\end_layout

\begin_layout LyX-Code
      <value>ABQOBJREFUevQ18FNW9/3+C/q7tza+tXB ...
 AARK5CYII=</value>
\end_layout

\begin_layout LyX-Code
    </field>
\end_layout

\begin_layout LyX-Code
    <field>
\end_layout

\begin_layout LyX-Code
      <name>test1</name>
\end_layout

\begin_layout LyX-Code
      <value>banana</value>
\end_layout

\begin_layout LyX-Code
    </field>
\end_layout

\begin_layout LyX-Code
    <field>
\end_layout

\begin_layout LyX-Code
      <name>test2</name>
\end_layout

\begin_layout LyX-Code
      <value>orange</value>
\end_layout

\begin_layout LyX-Code
    </field>
\end_layout

\begin_layout LyX-Code
    <field>
\end_layout

\begin_layout LyX-Code
      <name>test2</name>
\end_layout

\begin_layout LyX-Code
      <value>apple</value>
\end_layout

\begin_layout LyX-Code
    </field>
\end_layout

\begin_layout LyX-Code
    <field>
\end_layout

\begin_layout LyX-Code
      <name>test3</name>
\end_layout

\begin_layout LyX-Code
      <value>orange</value>
\end_layout

\begin_layout LyX-Code
    </field>
\end_layout

\begin_layout LyX-Code
  </fields>
\end_layout

\begin_layout LyX-Code
</input>
\end_layout

\begin_layout Standard
The servlet takes care of keeping only the input fields of the command activated
 by the drop down menu.
 The xml ouput can be read in the 
\emph on
sb.toString()
\emph default
 variable and has to be validated by the gsn system.
 The feedback is sent to the user as explained before and corresponds, in
 the servlet, to the 
\emph on
msg
\emph default
 and 
\emph on
code
\emph default
 variables.
 The 
\emph on
msg
\emph default
 could be any text string but should escape single quote and will be displayed
 at the top of the webinterface.
 A 
\emph on
code
\emph default
 higher than 200 is considered as an error and is shown in red to the user,
 otherwise it is in black.
 Nevertheless the code is not shown to the user in the current interface.
\end_layout

\begin_layout Subsection
Testing & Debugging
\end_layout

\begin_layout Standard
GSN webapp was fully tested using the main browsers on the web: Internet
 Explorer, Firefox & Opera.
 There was not any formal testing routine or unit testing.
 However, the core functionality were tested in the three browsers to ensure
 that they were working similarly.
\end_layout

\begin_layout Standard
After a month of implementation, the interface was quite advanced but never
 tested with many sensors.
 When we added more than 40 sensors, it became ridiculously slow.
 It took more than 15 seconds to show them.
 JavaScript is slow and using some nice syntax features of jQuery can be
 very expensive, especially the $("") function ! By refactoring the code,
 avoiding to use the most expensive functions and extensive testing, the
 execution time was reduced to less than two seconds, thus an improvement
 of a factor ten.
 However, as the number of virtual sensors could be even much bigger, it
 was decided to show only the first ten sensors on the front page to bound
 the loading time.
 Later, the speed was again improved by updating jQuery to the new 1.1 version.
\end_layout

\begin_layout Subsubsection
Javascript debugging
\end_layout

\begin_layout Standard
With ajax webapp, the amount of complex javascript code is significant,
 thus it needs to be debugged and analyzed.
 Hopefully, a relatively new extension for FireFox called FireBug
\begin_inset LatexCommand cite
key "firebug"

\end_inset

 helps a lot.
\end_layout

\begin_layout Standard
\align center
\begin_inset Graphics
	filename figures/chapterWebInterface/firebug.png
	width 100text%

\end_inset

 
\end_layout

\begin_layout Standard
As shown above, it allows to easily output debugging messages with the 
\emph on
console.debug(...)
\emph default
 object.
 Objects can be fully analysed and changed.
 The html and css code could be modified on the fly.
 This is very powerful and helps a lot.
\end_layout

\begin_layout Standard
Nevertheless, when testing gsn compatibility with IE, this is a pain to
 not have FireBug.
 Moreover that IE usually have some weird and hard to catch JavaScript bug.
\end_layout

\begin_layout Subsection
GPSVS sensor
\end_layout

\begin_layout Standard
A GPS bluetooth sensor was received during the project development.
 A small virtual sensor was created to test it.
 Using the serial port wrapper, it was very fast and easy to do.
 This experience also brought some relevant feedback to the team.
 The sensor code was quickly put together using a serial port wrapper, as
 bluetooth supports serial port emulation (BlueTooth Serial Port Profile).
 GPS sensors actually have some specification for their output called NMEA
\begin_inset LatexCommand cite
key "nmea"

\end_inset

.
 Only a subset of it was implemented, the GPRMC part to be precise.
 This is some formatted text only output looking for example like 
\emph on
"$GPRMC,081836,A,3751.65,S,14507.36,E,000.0,360.0,130998,011.3,E*62"
\emph default
 which has to be converted to Google maps coordinates.
\end_layout

\begin_layout Standard
The GPS sensor was developed using a GPSlim device but should be successfully
 used by any device following the NMEA specification.
 It was actually tested with a Nokia GPS device without any modification.
 The only small problem was the linkage of the Nokia GPS device which requires
 a passcode.
 It can be found deep down in the documentation and is 0000 by default.
\end_layout

\begin_layout Chapter
Writing a Protocol Description
\end_layout

\begin_layout Standard
In many cases, your data sources will emit structured data that respect
 a predefined format.
 Such a format is called a protocol.
 It is of course possible to do the data extraction from the received data
 packets with your own code.
 However, when these protocols are complex, the task is not that easy and
 it can consume a lot of time.
\end_layout

\begin_layout Standard
This is why GSN ships with the jnetstream packet decoding library.
 To use it with your protocol, you only need to describe your packets structure
 in a C-like syntax.
 You will be able to update the protocol definition without recompiling
 the parser.
 For more information, please consult 
\begin_inset LatexCommand htmlurl
target "http://jnetstream.sourceforge.net"

\end_inset

.
\end_layout

\begin_layout Standard
It is also possible to build such packets using jnetstream.
 This feature is currently in development.
 This allows to communicate with your data source.
\end_layout

\begin_layout Standard

\end_layout

\begin_layout Standard
\begin_inset LatexCommand printindex

\end_inset


\end_layout

\end_body
\end_document
