
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
<head> 
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8" /> 
		<title>GSN</title> 
		
		<link rel="stylesheet" href="style/gsn.css" type="text/css" media="screen,projection" /> 
		<script type="text/javascript" src="js/jquery-1.6.1.min.js"></script> 
		<script type="text/javascript" src="js/jquery-dom.js"></script> 
		<script type="text/javascript" src="js/jquery.history.js"></script> 
		<script type="text/javascript" src="js/jquery-tooltip.js"></script> 
		<script type="text/javascript" src="js/jquery.cookie.js"></script> 
		<link rel="stylesheet" type="text/css" href="style/jquery-ui-1.8.13.custom.css" /> 
		<script type='text/javascript' src='js/jquery-ui-1.8.13.min.js'></script>
		
		<!-- Include Map engine-->
		<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAcCxhFM99SMIShXVUlt9hZRRGT91DJS6ifzq9ijoOaiWK5z_I1BRDP2R8dbyv6XV3PpLLr1UtST_64w" type="text/javascript"></script>
		<script type="text/javascript" src="js/mapstraction.js"></script>
		
		<script type="text/javascript" src="js/constants.js"></script>
		<script type="text/javascript" src="js/functions.js"></script>
		<script type="text/javascript" src="js/gsn.js"></script>
		<script type="text/javascript" src="js/uptime.js"></script>

<script type="text/javascript">
		<!--//<![CDATA[
		var mapProvider = null;
		var topologyUpdateInfo;

		$(document).ready(function() {
		
				mapProvider = DEFAULT_MAP_PROVIDER;
				map = new Mapstraction('vsmap',mapProvider);
		
        //bind every buttons to javascript functionality (only once)
        $("#refreshall_timeout").bind("change",GSN.updateallchange);
        $("#refreshall").bind("click",GSN.updateall);
        $("#toggleallmarkers").bind("click()",GSN.map.toggleAllMarkers);
        $("#navigation ul a.local").bind("click",function() { return GSN.nav($(this).text()); });

        GSN.load();
        GSN.map.toggleAllMarkers();
        topologyUpdateTimer = setTimeout("fetchTopologyInfo", 5000);
        fetchTopologyInfo();
        GSN.map.showAllMarkers();
		});

function fetchTopologyInfo() {
  	$.ajax({
        	type: "GET",
	        url: "/field?vs=ostest_gps_position__public&field=DATA&pk=latest",
        	dataType: "xml",
	        success: function(data){
			$("sensornode",$("sensornodes",data)).each(function() {
      				var id = $(this).attr("node_id");
				var lati = $(this).attr("latitude");
				var longi = $(this).attr("longitude");

				var absdlat = Math.abs( Math.round(Math.round(lati/100) * 1000000.));
				var absmlat = Math.abs( Math.round((lati - absdlat/10000) * 1000000.));

				var absdlon = Math.abs( Math.round(Math.round(longi/100) * 1000000.));
				var absmlon = Math.abs( Math.round((longi - absdlon/10000) * 1000000.));

				lati = Math.round(absdlat + (absmlat/60.) ) * 1/1000000;
				longi = Math.round(absdlon + (absmlon/60.) ) * 1/1000000;

				GSN.map.updateMarker("ostest_gps_nav__mapped", id, longi, lati);
			})
			GSN.load();
        	  	topologyUpdateTimer = setTimeout("fetchTopologyInfo()",5000);
        	},
        	error : function(XMLHttpRequest, textStatus, errorThrown) {
          		topologyUpdateTimer = setTimeout("fetchTopologyInfo()",10000);
        	}
      	});
};

//]]>-->
        </script>




    </head>
    <body onunload="">

        <div id="container">
            <div id="header">
                <h1><a href="." id="gsn-name">GSN</a></h1>
            </div>
            <div id="navigation">
            </div>
            <div id="main">
                <noscript><p class="error">Your browser doesn't appear to support JavaScript. This is most likely because you're using a text-based or otherwise non-graphical browser. Sadly, GSN require javascript in order to work properly. If you want to access directly the data, you can use the api at <a href="http://localhost:22001/gsn">http://localhost:22001/gsn</a>.</p></noscript>

                <div id="control">
                    <iframe name="webupload" style="border:0;height:0;width:0;"></iframe>
                    <!-- <div id="msg">Welcome to Global Sensor Networks. The first ten sensors are displayed by default, but you can easily close them with the <em>close all</em> button. By clicking on a virtual sensors on the left sidebar, it will bring it to the top of the list.</div> -->

                    <p>Auto-refresh every :
                        <select id="refreshall_timeout" >
                            <option value="3600000">1hour</option>
                            <option value="600000">10min</option>
                            <option value="60000" selected="selected">1min</option>
                            <option value="30000">30sec</option>
                            <option value="5000">5sec</option>
                            <option value="1000">1sec</option>
                            <option value="0">disable</option>
                        </select>
                        <input id="refreshall" type="button" value="refresh" />
                        <span class="refreshing"><img src="style/ajax-loader.gif" alt="loading" title="" /></span>
                    </p>
                </div>

                <div id="homediv">
                    <div id="vs">
                        <div class="loading">Virtual sensors are currently loading...</div>
                    </div>
                </div>


                <!-- map part -->
                <div id="mapdiv">

                    <p><a style="text-decoration:underline" href="javascript:GSN.map.showAllMarkers();">Auto-zoom and focus the map</a></p>
                    <div id="vsmap" style="width: 100%; height: 500px; position:relative;"></div>
                    <div id="vs4map"></div>
                </div>

            </div>
    	   <div class="separator"> 
		<div id="footer"> 
		      <table width="100%"> 
				<tr> 
					<td style="width:50%;color:#444444;"><b>A Project of <a href="http://www.ethz.ch" target="_blank">ETH Zurich</a>, <a href="http://www.unibas.ch" target="_blank">Uni Basel</a> and <a href="http://www.uzh.ch" target="_blank">Uni Zurich</a></b></td> 
					<td style="text-align:right;width:50%;font-size:9px;">Powered by <a href="http://gsn.sourceforge.net/">GSN</a>,  Distributed Information Systems Lab, EPFL 2006</td> 
				</tr> 
			</table> 
		</div> 
	</div> 
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-5632004-2");
pageTracker._initData();
pageTracker._trackPageview();
</script>
    </body>
</html>
