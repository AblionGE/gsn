<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
	<title>GSN</title>
	
	<link rel="stylesheet" href="style/gsn.css" type="text/css" media="screen,projection" />
	<script type="text/javascript" src="js/jquery-latest.pack.js"></script>
	<script type="text/javascript" src="js/jquery-dom.js"></script>
	<script type="text/javascript" src="js/jquery.history.js"></script>
	<script type="text/javascript" src="js/jquery-tooltip.js"></script>
	<script type="text/javascript" src="js/jquery.cookie.js"></script>

	<script type="text/javascript" src="js/constants.js"></script>
	<script type="text/javascript" src="js/functions.js"></script>
	
        <script type="text/javascript" src="js/uptime.js"></script>
<script type="text/javascript">
<!--//<![CDATA[

var initialUpdateVal = 600;
var nextUpdateVal = initialUpdateVal;
var deployments = new Array();
var weatherStation = new Array();

function updateHealth()
{
	var d = new Date();
	for (var i in deployments) {
	    $("#health_"+deployments[i]).find("img").each(function() {
	      $(this).attr('src',$(this).attr("src").split("?")[0]+"?date="+ d.getTime());
	    });
	}
}

function nextUpdate()
{
	if(nextUpdateVal==0) nextUpdateVal=initialUpdateVal+1;
	
	nextUpdateVal--;
	
	$("#nextUpdate").text(nextUpdateVal);
	
	if(nextUpdateVal==0) 
	{
		updateHealth();
	}
	setTimeout("nextUpdate()",1000);
}

$(document).ready(function() {
	$("#navigation ul a.local").bind("click",function() { return GSN.nav($(this).text()); });
			
	$("#nextUpdate").text(nextUpdateVal);
	setTimeout("nextUpdate()",1000);
	
	// deployments
	// load deployments
	$.ajax({
	      type: "GET",
	      url: "/gsn?structure",
	      success: function(data){
                if ($(document).attr("title")=="GSN") {
                  var gsn = $("gsn",data);
                  $(document).attr("title",$(gsn).attr("name"));
                  $("#gsn-name").empty().append($(gsn).attr("name"));
                  $("#gsn-desc").empty().append($(gsn).attr("description"));
                  $("#gsn-author").empty().append($(gsn).attr("author")+" ("+$(gsn).attr("email")+")");
                }
                $("#gsn-name").show();
                uptime.setTime($(gsn).attr("uptime"));
		var arraySize = 0;
		$("virtual-sensor",data).each(function(){
		    var deploymentname = $(this).attr("name").split("_", 1)[0];
		    if(deploymentname.length > 1) {
			deploymentname = deploymentname.substring(0, 1).toUpperCase() + deploymentname.substring(1, deploymentname.length).toLowerCase();
			if (deploymentname!='Statistics' && $.inArray(deploymentname, deployments) < 0) {
			    deployments.push(deploymentname);
                            weatherStation.push(false);
			}
                        if ($(this).attr("name").indexOf("vaisalawxt520")>0) {
                            var i;
                            for (i=0;i<deployments.length;i++)
                              if (deployments[i]==deploymentname)
                                weatherStation[i]=true;
                        }
		    }
		});
		// display
		var visible;
		if ($.inArray($.cookie("deployment"), deployments)>-1)
		  visible = $.cookie("deployment");
		else
		  visible = deployments[0];
		for (var i in deployments) {
		    // add tab
		    $("#deployment_menu").append($.LI({}, $.A({
			"id":"deployment_menu_item_"+deployments[i],
			"href":"javascript:showHealth("+i+")"
		    },deployments[i])));
		    // add div
		    $("#healthcontainer").append(
			$.DIV({
			    "id":"health_"+deployments[i]
			      },
			  $.P({},
			  $.IMG({
			    "src":"http://people.ee.ethz.ch/~perma/plots/image_"+deployments[i].toLowerCase()+"_V12DCIN.png"
			  })),
			  $.P({},
			  $.IMG({
			    "src":"http://people.ee.ethz.ch/~perma/plots/image_"+deployments[i].toLowerCase()+"_BasestationTemperature.png"
			  })),
			  $.P({},
			  $.IMG({
			    "src":"http://people.ee.ethz.ch/~perma/plots/image_"+deployments[i].toLowerCase()+"_BasestationHumidity.png"
			  }))
			));
                    if (weatherStation[i]==true) {
                      $("#health_"+deployments[i]).append(
                          $.P({},"Weatherstation"),
                          $.P({},
                          $.IMG({
                            "src":"http://people.ee.ethz.ch/~perma/plots/image_"+deployments[i].toLowerCase()+"_Voltages.png"
                          })),
                          $.P({},
                          $.IMG({
                            "src":"http://people.ee.ethz.ch/~perma/plots/image_"+deployments[i].toLowerCase()+"_Humidity.png"
                          })),
                          $.P({},
                          $.IMG({
                            "src":"http://people.ee.ethz.ch/~perma/plots/image_"+deployments[i].toLowerCase()+"_Temperature.png"
                          })),
                          $.P({},
                          $.IMG({
                            "src":"http://people.ee.ethz.ch/~perma/plots/image_"+deployments[i].toLowerCase()+"_Air-Pressure.png"
                          })),
                          $.P({},
                          $.IMG({
                            "src":"http://people.ee.ethz.ch/~perma/plots/image_"+deployments[i].toLowerCase()+"_Rain.png"
                          })),
                          $.P({},
                          $.IMG({
                            "src":"http://people.ee.ethz.ch/~perma/plots/image_"+deployments[i].toLowerCase()+"_Hail.png"
                          })),
                          $.P({},
                          $.IMG({
                            "src":"http://people.ee.ethz.ch/~perma/plots/image_"+deployments[i].toLowerCase()+"_Winddirection.png"
                          })),
                          $.P({},
                          $.IMG({
                            "src":"http://people.ee.ethz.ch/~perma/plots/image_"+deployments[i].toLowerCase()+"_Windspeed.png"
                          })),
                          $.P({},
                          $.IMG({
                            "src":"http://people.ee.ethz.ch/~perma/plots/rose_"+deployments[i].toLowerCase()+"_Winddirection.png"
                          }))
                        );
                    }
		    if (deployments[i]!=visible)
			$("#health_"+deployments[i]).hide();
		    else
			$("#deployment_menu_item_"+deployments[i]).addClass("selected");
		}
		updateHealth();
	      }
	});	
});	

function showHealth(id) {
  for (var i in deployments) {
      $("#health_"+deployments[i]).hide();
      $("#deployment_menu_item_"+deployments[i]).removeClass("selected");
  }
  $("#health_"+deployments[id]).show();
  $("#deployment_menu_item_"+deployments[id]).addClass("selected");
  $.cookie("deployment" , deployments[id]);
}	
//]]>-->
</script>
</head>
<body>

<div id="container">
	<div id="header">
		<h1><a href="." id="gsn-name" style="display:none">GSN</a></h1>
	</div>
	<div id="navigation">
		<ul id="menu">
			<li><a href="index.html#home">home</a></li>
			<li><a href="data.html#data">data browser</a></li>
			<li><a href="topology.html#topology">network topology</a></li>
			<li><a href="nodehealth.html#nodehealth">node health</a></li>
			<li class="selected"><a href="basehealth.html#basehealth">base health</a></li>
			<li><a href="weather.html#weather">on-site weather</a></li>
			<li><a href="map.html#map">map</a></li>
			<!-- <li><a href="fullmap.html#fullmap">fullmap</a></li> -->
		</ul>
		<ul id="linkWebsite"><li><a href="http://www.permasense.ch" target="_blank">PermaSense Home</a></li></ul>
	</div>
	
	<div id="separator">
		<div id="starttext">
			<p>
				Current basestation health data.
			</p>
		</div>
	</div>
	
	
	<div id="maindiv">

		<div id="deployment_navigation">
		<ul id="deployment_menu">
		</ul>
		</div>	
		
		<p id="updatetext">next update in <span id="nextUpdate">??</span> seconds</p>

		<div id="healthcontainer"></div>
		
<!--		<p>Matterhorn Weatherstation</p>
		<p><img src="http://people.ee.ethz.ch/~perma/plots/image_matterhorn_Voltages.png"/></p>
	        <p><img src="http://people.ee.ethz.ch/~perma/plots/image_matterhorn_Humidity.png"/></p>
	        <p><img src="http://people.ee.ethz.ch/~perma/plots/image_matterhorn_Temperature.png"/></p> 
		<p><img src="http://people.ee.ethz.ch/~perma/plots/image_matterhorn_Air-Pressure.png"/></p>
		<p><img src="http://people.ee.ethz.ch/~perma/plots/image_matterhorn_Rain.png"/></p>
		<p><img src="http://people.ee.ethz.ch/~perma/plots/image_matterhorn_Hail.png"/></p>
		<p><img src="http://people.ee.ethz.ch/~perma/plots/image_matterhorn_Winddirection.png"/></p>
		<p><img src="http://people.ee.ethz.ch/~perma/plots/image_matterhorn_Windspeed.png"/></p>
		<p><img src="http://people.ee.ethz.ch/~perma/plots/rose_matterhorn_Winddirection.png"/></p>-->
	</div>
	<div class="separator">
		<div id="footer">
		      <table width="100%">
				<tr>
					<td style="width:50%;color:#444444;"><b>A Project of <a href="http://www.ethz.ch" target="_blank">ETH Zurich</a>, <a href="http://www.unibas.ch" target="_blank">Uni Basel</a> and <a href="http://www.uzh.ch" target="_blank">Uni Zurich</a></b></td>
					<td style="text-align:right;width:50%;font-size:9px;">Powered by <a href="http://gsn.sourceforge.net/">GSN</a>,  Distributed Information Systems Lab, EPFL 2006</td>
				</tr>
			</table>
		</div>
	</div>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-5632004-2");
pageTracker._initData();
pageTracker._trackPageview();
</script>
</body>
</html>
